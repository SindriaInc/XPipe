<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<xpdl:Package xmlns:xpdl="http://www.wfmc.org/2008/XPDL2.1" xmlns="http://www.wfmc.org/2008/XPDL2.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" Id="Package_assetmgt" xsi:schemaLocation="http://www.wfmc.org/2008/XPDL2.1 http://www.wfmc.org/standards/docs/bpmnxpdl_31.xsd">
    <xpdl:PackageHeader>
        <xpdl:XPDLVersion>2.1</xpdl:XPDLVersion>
        <xpdl:Vendor/>
        <xpdl:Created/>
    </xpdl:PackageHeader>
    <xpdl:Script Type="text/java"/>
    <xpdl:TypeDeclarations>
        <xpdl:TypeDeclaration Id="Reference">
            <xpdl:ExternalReference location="org.cmdbuild.workflow.type.ReferenceType"/>
        </xpdl:TypeDeclaration>
        <xpdl:TypeDeclaration Id="References">
            <xpdl:ExternalReference location="org.cmdbuild.workflow.type.ReferenceType&lt;&gt;"/>
        </xpdl:TypeDeclaration>
        <xpdl:TypeDeclaration Id="Lookup">
            <xpdl:ExternalReference location="org.cmdbuild.workflow.type.LookupType"/>
        </xpdl:TypeDeclaration>
        <xpdl:TypeDeclaration Id="Lookups">
            <xpdl:ExternalReference location="org.cmdbuild.workflow.type.LookupType&lt;&gt;"/>
        </xpdl:TypeDeclaration>
    </xpdl:TypeDeclarations>
    <xpdl:Participants>
        <xpdl:Participant Id="System">
            <xpdl:ParticipantType Type="SYSTEM"/>
        </xpdl:Participant>
        <xpdl:Participant Id="SuperUser">
            <xpdl:ParticipantType Type="ROLE"/>
        </xpdl:Participant>
    </xpdl:Participants>
    <xpdl:Pools>
        <xpdl:Pool BoundaryVisible="true" Id="Package_assetmgt_pool1" MainPool="true" Name="Process_assetmgt" Orientation="HORIZONTAL" Process="Process_assetmgt">
            <xpdl:Lanes>
                <xpdl:Lane Id="Package_assetmgt_pool1_lan1" Name="Expression lane">
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,215" IsVisible="true" ToolId="JaWE"/>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,215" IsVisible="true" ToolId="JaWE"/>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Lane>
            </xpdl:Lanes>
            <xpdl:NodeGraphicsInfos>
                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,215" IsVisible="true" ToolId="JaWE"/>
            </xpdl:NodeGraphicsInfos>
        </xpdl:Pool>
        <xpdl:Pool BoundaryVisible="true" Id="Package_assetmgt_pool2" MainPool="true" Name="Process_assetmgt_ase1" Orientation="HORIZONTAL" Process="BA-CheckSelection">
            <xpdl:Lanes>
                <xpdl:Lane Id="Package_assetmgt_pool2_lan2" Name="Expression lane">
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,215" IsVisible="true" ToolId="JaWE"/>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,215" IsVisible="true" ToolId="JaWE"/>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Lane>
            </xpdl:Lanes>
            <xpdl:NodeGraphicsInfos>
                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,215" IsVisible="true" ToolId="JaWE"/>
            </xpdl:NodeGraphicsInfos>
        </xpdl:Pool>
        <xpdl:Pool BoundaryVisible="true" Id="Package_assetmgt_pool3" MainPool="true" Name="Process_assetmgt_ase1" Orientation="HORIZONTAL" Process="BA-SetClosureData">
            <xpdl:Lanes>
                <xpdl:Lane Id="Package_assetmgt_pool3_lan1" Name="System">
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="40,145,195" IsVisible="true" ToolId="JaWE"/>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="40,145,195" IsVisible="true" ToolId="JaWE"/>
                    </xpdl:NodeGraphicsInfos>
                    <xpdl:Performers>
                        <xpdl:Performer>System</xpdl:Performer>
                    </xpdl:Performers>
                </xpdl:Lane>
            </xpdl:Lanes>
            <xpdl:NodeGraphicsInfos>
                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,215" IsVisible="true" ToolId="JaWE"/>
            </xpdl:NodeGraphicsInfos>
        </xpdl:Pool>
        <xpdl:Pool BoundaryVisible="true" Id="Package_assetmgt_pool4" MainPool="true" Name="Process_assetmgt_ase1" Orientation="HORIZONTAL" Process="BA-AssetData">
            <xpdl:Lanes>
                <xpdl:Lane Id="Package_assetmgt_pool4_lan1" Name="Expression lane">
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,215" IsVisible="true" ToolId="JaWE"/>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,215" IsVisible="true" ToolId="JaWE"/>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Lane>
            </xpdl:Lanes>
            <xpdl:NodeGraphicsInfos>
                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,215" IsVisible="true" ToolId="JaWE"/>
            </xpdl:NodeGraphicsInfos>
        </xpdl:Pool>
    </xpdl:Pools>
    <xpdl:WorkflowProcesses>
        <xpdl:WorkflowProcess AccessLevel="PUBLIC" Id="Process_assetmgt">
            <xpdl:ProcessHeader/>
            <xpdl:DataFields>
                <xpdl:DataField Id="ClosureTimestamp" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="DATETIME"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="Code" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="Confirm" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="BOOLEAN"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="CreationTimestamp" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="DATETIME"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="Description" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="DstRoom" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Reference"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="DstStatus" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Lookup"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="DstUser" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Reference"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="DstWrhouse" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Reference"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="FlowStatus" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Lookup"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="GRAssetsAction" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Lookup"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="GRHeaderAction" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Lookup"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="Message" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Lookup"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="Notes" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="Number" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="Order" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Reference"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="OrderRow" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Reference"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="OrderRowBrand" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Lookup"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="OrderRowCMDBClass" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Lookup"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="OrderRowModel" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="OrderRowQty" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="INTEGER"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="OrigRoom" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Reference"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="OrigUser" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Reference"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="OrigWrhouse" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Reference"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="ProcessCode" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="ProcessStatus" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Lookup"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="Process_assetmgt_df1" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="SendEmail" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="BOOLEAN"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="Supplier" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Reference"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="Type" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Lookup"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="UniqueProcessDefinition" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="Wrhouse" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="Reference"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="attrSeparator" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                    <xpdl:InitialValue>%</xpdl:InitialValue>
                </xpdl:DataField>
                <xpdl:DataField Id="className" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="currentGroup" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="error" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="BOOLEAN"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="exit" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="BOOLEAN"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="formLibrary" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                    <xpdl:InitialValue>import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.text.DateFormat;
import java.text.SimpleDateFormat;
import org.apache.commons.lang3.StringUtils;

import org.cmdbuild.shark.Logging;
import org.slf4j.LoggerFactory;
import org.slf4j.Logger;

logger = LoggerFactory.getLogger(Logging.LOGGER_NAME);

String findFormName (classname) {
	logger.debug("find form name for class {}", classname);

	spResult = cmdb.callFunction("wf_assetmgt_formname") //
			.with("classname", classname) //
			.execute();

	formName = spResult.get("FormName");
	logger.debug("form name is {}", formName);

	return formName;

}

// Given a form name, load the model for the customForm widget
String loadFormModel (String formName) {
	String formModel;

	// Create a structure which allows to order the parameters by index
	Set objects = new TreeSet(new Comparator() {
		int compare(JSONObject o0, JSONObject o1) {
			try {
				Integer index0 = new Integer(o0.getInt("index"));
				Integer index1 = new Integer(o1.getInt("index"));
				return index0.compareTo(index1);
			} catch(JSONException e) {
				throw new RuntimeException(e);
			}
		}
	});
	
	formId = cmdb.queryClass("AMForm")
		.withCode(formName)
		.fetch()
		.get(0)
		.getId();

	logger.debug("formId is {}", formId);

	// Load the parameters into the database and build the formModel
	parameters = cmdb.queryClass("AMFormField")
			.with("Form", formId)
			.fetch();

	logger.debug("parameters are {}", parameters);

	JSONArray a = new JSONArray();
	JSONObject o;
	String[] metadata;
	String[] keyValue;
	String key;
	String value;
	String filterExpression;
	String targetName;
	String targetType;
	JSONObject filterContext;
	for ( param : parameters ) {
	
		logger.debug("param is {}", param);
		
		o = new JSONObject();

		value = param.get("Name");

		logger.debug("field name is {}", value);

		if ( StringUtils.isNotBlank(value) ) {
			o.put("name", value);
		}
		value = param.get("Description");

		logger.debug("field description is {}", value);

		if ( StringUtils.isNotBlank(value) ) {
			o.put("description", value);
		}
		value = param.get("Type");
		if ( StringUtils.isNotBlank(value) ) {
			o.put("type", value);
		}
		value = String.valueOf(param.get("Index"));
		if ( StringUtils.isNotBlank(value) ) {
			o.put("index", value);
		}

		metadata = param.get("Metadata").split("\\|");
		for ( String md : metadata ) {
			keyValue = md.split("#:#");
			if ( keyValue.length &lt; 2 ) continue;
			key = keyValue[0].trim();				
			value = keyValue[1].trim();
			switch(key) {
			case "lookupType":
			case "targetClass":
				o.put(key, value);
				break;
			case "length":
				o.put(key, Integer.valueOf(value));
			case "precision":
			case "scale": 
				o.put(key, Integer.valueOf(value));					
				break;
			case "showColumn":
			case "hidden":
			case "mandatory":
			case "writable": 
				o.put(key, Boolean.valueOf(value));
				break;
			case "target-type": 
			case "target-name": 
				if ( "target-type".equals(key) ) {
					targetType = value;
				} else {
					targetName = value;
				}
				if ( StringUtils.isNotBlank(targetName) &amp;&amp;  StringUtils.isNotBlank(targetType) ) {
					JSONObject target = new JSONObject();
					target.put("name", targetName);
					target.put("type", targetType);
					o.put("target", target);
				}
				break;
			case "filter-expression": 
				JSONObject filter = new JSONObject();
				filter.put("expression", value);
				o.put("filter", filter);
				break;
			case "filter-context": 
				if(StringUtils.isNotBlank(value)) {
					throw new UnsupportedOperationException("Unsupported filter contexts, must be blank");
				}
				break;
			case "index":
				break;
			default: 
				throw new UnsupportedOperationException("Unsupported parameter property: " + key);
			}
		}

		objects.add(o);
	}
	for(JSONObject so : objects) {
		so.remove("index");
		a.put(so);
	}

	formModel = a.toString();
	logger.warn("\n--- formModel -----------------------------------------------\n" + 
			           formModel +  "\n" +
         		  "-------------------------------------------------------------");
	return formModel;
}</xpdl:InitialValue>
                </xpdl:DataField>
                <xpdl:DataField Id="formModel" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="functionLibrary" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                    <xpdl:InitialValue>import com.google.common.base.Predicate;
import com.google.common.collect.Iterables;
import com.google.common.collect.Lists;
import org.cmdbuild.services.soap.AttributeSchema;
import org.cmdbuild.services.soap.Private;
import org.cmdbuild.api.fluent.ws.ClassAttribute;
import org.cmdbuild.api.fluent.ws.WsFluentApiExecutor.WsType;
import org.apache.commons.lang3.StringUtils;


isReference(classname, attributename){
	
	attribute = ClassAttribute.classAttribute(classname, attributename);
	type = cmdb.findAttributeFor(attribute).getWsType();
	return type == WsType.REFERENCE;
	
}

isValidValueForReference(input){
	return !StringUtils.isBlank(input) &amp;&amp; Integer.parseInt(input) &gt; 0;
}</xpdl:InitialValue>
                </xpdl:DataField>
                <xpdl:DataField Id="iterator" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="INTEGER"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="keyvalueSeparator" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                    <xpdl:InitialValue>==</xpdl:InitialValue>
                </xpdl:DataField>
                <xpdl:DataField Id="loggerLibrary" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                    <xpdl:InitialValue>import org.cmdbuild.shark.Logging;
import org.slf4j.LoggerFactory;
import org.slf4j.Logger;

logger = LoggerFactory.getLogger(Logging.LOGGER_NAME);</xpdl:InitialValue>
                </xpdl:DataField>
                <xpdl:DataField Id="newassets" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="orderRows" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="orderRowsIdList" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="rowSeparator" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:BasicType Type="STRING"/>
                    </xpdl:DataType>
                    <xpdl:InitialValue>%%</xpdl:InitialValue>
                </xpdl:DataField>
                <xpdl:DataField Id="selectedHardware" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="References"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="selectedHardwareToAssign" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="References"/>
                    </xpdl:DataType>
                </xpdl:DataField>
                <xpdl:DataField Id="selectedHardwareToWithdraw" IsArray="false">
                    <xpdl:DataType>
                        <xpdl:DeclaredType Id="References"/>
                    </xpdl:DataType>
                </xpdl:DataField>
            </xpdl:DataFields>
            <xpdl:ActivitySets>
                <xpdl:ActivitySet Id="BA-CheckSelection">
                    <xpdl:Activities>
                        <xpdl:Activity Id="Process_assetmgt_act13">
                            <xpdl:Event>
                                <xpdl:StartEvent Trigger="None"/>
                            </xpdl:Event>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="102,204,51" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool2_lan2" ToolId="JaWE" Width="31">
                                    <xpdl:Coordinates XCoordinate="121" YCoordinate="76"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="Process_assetmgt_act14">
                            <xpdl:Event>
                                <xpdl:EndEvent Result="None"/>
                            </xpdl:Event>
                            <xpdl:TransitionRestrictions>
                                <xpdl:TransitionRestriction>
                                    <xpdl:Join Type="Exclusive"/>
                                </xpdl:TransitionRestriction>
                            </xpdl:TransitionRestrictions>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool2_lan2" ToolId="JaWE" Width="31">
                                    <xpdl:Coordinates XCoordinate="557" YCoordinate="77"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="SYS13-CheckSelection" Name="SYS13 - Check selection">
                            <xpdl:Implementation>
                                <xpdl:Task>
                                    <xpdl:TaskScript>
                                        <xpdl:Script ScriptType="text/java">Message = null;
if(selectedHardware == null || selectedHardware.length == 0){
	Message = cmdb.selectLookupByCode("ITProc - Message","AM-EmptySelection");
}</xpdl:Script>
                                    </xpdl:TaskScript>
                                </xpdl:Task>
                            </xpdl:Implementation>
                            <xpdl:Performers>
                                <xpdl:Performer/>
                            </xpdl:Performers>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool2_lan2" ToolId="JaWE" Width="90">
                                    <xpdl:Coordinates XCoordinate="185" YCoordinate="61"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="AM12-ConfirmSelection" Name="AM12 - Confirm selection">
                            <xpdl:Implementation>
                                <xpdl:No/>
                            </xpdl:Implementation>
                            <xpdl:Performers>
                                <xpdl:Performer>currentGroup</xpdl:Performer>
                            </xpdl:Performers>
                            <xpdl:ExtendedAttributes>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Message"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATE" Value="Confirm"/>
                            </xpdl:ExtendedAttributes>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool2_lan2" ToolId="JaWE" Width="90">
                                    <xpdl:Coordinates XCoordinate="431" YCoordinate="64"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="Process_assetmgt_act16">
                            <xpdl:Route GatewayType="Exclusive"/>
                            <xpdl:TransitionRestrictions>
                                <xpdl:TransitionRestriction>
                                    <xpdl:Split Type="Exclusive">
                                        <xpdl:TransitionRefs>
                                            <xpdl:TransitionRef Id="Process_assetmgt_tra40"/>
                                            <xpdl:TransitionRef Id="Process_assetmgt_tra41"/>
                                        </xpdl:TransitionRefs>
                                    </xpdl:Split>
                                </xpdl:TransitionRestriction>
                            </xpdl:TransitionRestrictions>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool2_lan2" ToolId="JaWE" Width="43">
                                    <xpdl:Coordinates XCoordinate="305" YCoordinate="71"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                    </xpdl:Activities>
                    <xpdl:Transitions>
                        <xpdl:Transition From="SYS13-CheckSelection" Id="Process_assetmgt_tra37" To="Process_assetmgt_act16">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="AM12-ConfirmSelection" Id="Process_assetmgt_tra38" To="Process_assetmgt_act14">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="Process_assetmgt_act13" Id="Process_assetmgt_tra39" To="SYS13-CheckSelection">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="Process_assetmgt_act16" Id="Process_assetmgt_tra41" To="Process_assetmgt_act14">
                            <xpdl:Condition Type="CONDITION">Message == null</xpdl:Condition>
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                                    <xpdl:Coordinates XCoordinate="361" YCoordinate="23"/>
                                    <xpdl:Coordinates XCoordinate="605" YCoordinate="23"/>
                                </xpdl:ConnectorGraphicsInfo>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="Process_assetmgt_act16" Id="Process_assetmgt_tra40" To="AM12-ConfirmSelection">
                            <xpdl:Condition Type="OTHERWISE"/>
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                    </xpdl:Transitions>
                </xpdl:ActivitySet>
                <xpdl:ActivitySet Id="BA-SetClosureData">
                    <xpdl:Activities>
                        <xpdl:Activity Id="Process_assetmgt_act18">
                            <xpdl:Event>
                                <xpdl:StartEvent Trigger="None"/>
                            </xpdl:Event>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="102,204,51" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool3_lan1" ToolId="JaWE" Width="31">
                                    <xpdl:Coordinates XCoordinate="153" YCoordinate="67"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="Process_assetmgt_act19">
                            <xpdl:Event>
                                <xpdl:EndEvent Result="None"/>
                            </xpdl:Event>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool3_lan1" ToolId="JaWE" Width="31">
                                    <xpdl:Coordinates XCoordinate="379" YCoordinate="72"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="SYS14-SetClosureData" Name="SYS14 - Set closure data">
                            <xpdl:Implementation>
                                <xpdl:Task>
                                    <xpdl:TaskScript>
                                        <xpdl:Script ScriptType="text/java">ClosureTimestamp = Calendar.getInstance().getTime();
ProcessStatus = cmdb.selectLookupByCode("ITProc - ProcessStatus","Closed");
Confirm = null;
Message = null;</xpdl:Script>
                                    </xpdl:TaskScript>
                                </xpdl:Task>
                            </xpdl:Implementation>
                            <xpdl:Performers>
                                <xpdl:Performer/>
                            </xpdl:Performers>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool3_lan1" ToolId="JaWE" Width="90">
                                    <xpdl:Coordinates XCoordinate="244" YCoordinate="57"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                    </xpdl:Activities>
                    <xpdl:Transitions>
                        <xpdl:Transition From="Process_assetmgt_act18" Id="Process_assetmgt_tra46" To="SYS14-SetClosureData">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="SYS14-SetClosureData" Id="Process_assetmgt_tra47" To="Process_assetmgt_act19">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                    </xpdl:Transitions>
                </xpdl:ActivitySet>
                <xpdl:ActivitySet Id="BA-AssetData" Name="BA - Assets data">
                    <xpdl:Activities>
                        <xpdl:Activity Id="Process_assetmgt_act31">
                            <xpdl:Event>
                                <xpdl:StartEvent Trigger="None"/>
                            </xpdl:Event>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="102,204,51" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool4_lan1" ToolId="JaWE" Width="31">
                                    <xpdl:Coordinates XCoordinate="74" YCoordinate="95"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="Process_assetmgt_act32">
                            <xpdl:Event>
                                <xpdl:EndEvent Result="None"/>
                            </xpdl:Event>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool4_lan1" ToolId="JaWE" Width="31">
                                    <xpdl:Coordinates XCoordinate="1113" YCoordinate="103"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="AM02c-GRDelivery1" Name="AM02c - Goods receipt (delivered assets)">
                            <xpdl:Implementation>
                                <xpdl:No/>
                            </xpdl:Implementation>
                            <xpdl:Performers>
                                <xpdl:Performer>currentGroup</xpdl:Performer>
                            </xpdl:Performers>
                            <xpdl:TransitionRestrictions>
                                <xpdl:TransitionRestriction>
                                    <xpdl:Join Type="Exclusive"/>
                                </xpdl:TransitionRestriction>
                            </xpdl:TransitionRestrictions>
                            <xpdl:ExtendedAttributes>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Message"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRow"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRowCMDBClass"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRowBrand"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRowModel"/>
                                <xpdl:ExtendedAttribute Name="customForm" Value="ButtonLabel=&quot;Edit delivered assets&quot;&#13;&#10;Layout=&quot;grid&quot;&#13;&#10;ModelType=&quot;form&quot;&#13;&#10;FormModel=formModel&#13;&#10;DataType=&quot;function&quot;&#13;&#10;FunctionData=&quot;wf_assetmgt_newassets&quot;&#13;&#10;orderrow=&quot;{server:OrderRow.Id}&quot;&#13;&#10;AddDisabled=&quot;true&quot;&#13;&#10;CloneDisabled=&quot;true&quot;&#13;&#10;ImportDisabled=&quot;true&quot;&#13;&#10;ExportDisabled=&quot;true&quot;&#13;&#10;SerializationType = &quot;text&quot;&#13;&#10;    KeyValueSeparator = keyvalueSeparator&#13;&#10;    AttributesSeparator = attrSeparator&#13;&#10;    RowsSeparator = rowSeparator&#13;&#10;newassets"/>
                                <xpdl:ExtendedAttribute Name="openAttachment" Value="ButtonLabel=&quot;Add attachment&quot;"/>
                            </xpdl:ExtendedAttributes>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool4_lan1" ToolId="JaWE" Width="90">
                                    <xpdl:Coordinates XCoordinate="296" YCoordinate="86"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="SYS02c.1-CreateAssets1" Name="SYS02c.1 - Create assets">
                            <xpdl:Implementation>
                                <xpdl:Task>
                                    <xpdl:TaskScript>
                                        <xpdl:Script ScriptType="text/java">import org.cmdbuild.api.fluent.NewCard;

eval(loggerLibrary);
eval(functionLibrary);

error = false; 

try{
	String classname = cmdb.selectLookupById(OrderRowCMDBClass.getId()).getCode();
	String[] parts = newassets.split(rowSeparator);

	for (String card : parts) {
		if(card == null || card.isEmpty()){
			continue;
		}
		logger.warn("build card {}",card);
		String[] attributes = card.split(attrSeparator);
	
		NewCard newCard = cmdb.newCard(classname);
		for(String attribute : attributes){
			logger.warn("deserialize attribute {}",attribute);
			String[] keyValue = attribute.split(keyvalueSeparator); 
			if(keyValue.length &lt; 2){
				continue;
			}
			String name = keyValue[0];
			String value = keyValue[1];
			logger.warn("name is {}",name);
			logger.warn("string value is {}",value);
			if(isReference(classname, name) &amp;&amp; !isValidValueForReference(value)){
				logger.warn("skip invalid value {} for reference {}",value,name);
				continue;
			}
			newCard.with(name,value);
		}

		newasset_cd = newCard.create();
	
		cmdb.newRelation("AssetMgtCI") //
			.withCard1("AssetMgt", (int) ProcessId) //
			.withCard2("CI", (int) newasset_cd.getId()) //
			.create();

		cmdb.callFunction("wf_assetmgt_direction")
			.with("hardwareid", (int) newasset_cd.getId())
			.with("processid",(int) ProcessId)
			.with("direction","+")
			.execute();
	
	}

	orderRowCard = cmdb.existingCard("PurchaseOrderRow",OrderRow.getId()).fetch();
	totDeliveredQuantity = orderRowCard.get("DeliveredQuantity") + orderRowCard.get("DeliveryQuantity");

	cmdb.existingCard("PurchaseOrderRow",OrderRow.getId()) //
		.with("DeliveredQuantity",totDeliveredQuantity)
		.with("DeliveryQuantity",0)
		.update();

	Message = cmdb.selectLookupByCode("ITProc - Message", "AM-CheckNewAssets");
	iterator = iterator + 1;
}catch(Throwable t){
	Message = cmdb.selectLookupByCode("ITProc - Message", "AM-ErrorCreatingAssets");
	error = true;
}</xpdl:Script>
                                    </xpdl:TaskScript>
                                </xpdl:Task>
                            </xpdl:Implementation>
                            <xpdl:Performers>
                                <xpdl:Performer/>
                            </xpdl:Performers>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool4_lan1" ToolId="JaWE" Width="90">
                                    <xpdl:Coordinates XCoordinate="425" YCoordinate="83"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="SYSBA03-SetClassName">
                            <xpdl:Implementation>
                                <xpdl:Task>
                                    <xpdl:TaskScript>
                                        <xpdl:Script ScriptType="text/java">// reset custom form

newassets = null;</xpdl:Script>
                                    </xpdl:TaskScript>
                                </xpdl:Task>
                            </xpdl:Implementation>
                            <xpdl:Performers>
                                <xpdl:Performer/>
                            </xpdl:Performers>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool4_lan1" ToolId="JaWE" Width="90">
                                    <xpdl:Coordinates XCoordinate="151" YCoordinate="82"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="AM02d-CheckAssetsData" Name="AM02d - Goods receipt (check assets data)">
                            <xpdl:Implementation>
                                <xpdl:No/>
                            </xpdl:Implementation>
                            <xpdl:Performers>
                                <xpdl:Performer>currentGroup</xpdl:Performer>
                            </xpdl:Performers>
                            <xpdl:ExtendedAttributes>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Message"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRow"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRowCMDBClass"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRowBrand"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRowModel"/>
                                <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;CI&quot;&#13;&#10;ButtonLabel=&quot;New assets&quot;&#13;&#10;NoSelect=1&#13;&#10;Filter=&quot;from Hardware where Id in (/( SELECT map.&quot;IdObj2&quot; FROM &quot;Map_AssetMgtCI&quot; map JOIN &quot;AssetMgt&quot; am ON am.&quot;Id&quot; = map.&quot;IdObj1&quot; AND am.&quot;Id&quot;={xa:processid} WHERE map.&quot;Status&quot; = 'A')/)&quot;&#13;&#10;AllowCardEditing=&quot;true&quot;&#13;&#10;processid=ProcessId"/>
                            </xpdl:ExtendedAttributes>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool4_lan1" ToolId="JaWE" Width="90">
                                    <xpdl:Coordinates XCoordinate="637" YCoordinate="85"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="Process_assetmgt_act35">
                            <xpdl:Route GatewayType="Exclusive"/>
                            <xpdl:TransitionRestrictions>
                                <xpdl:TransitionRestriction>
                                    <xpdl:Split Type="Exclusive">
                                        <xpdl:TransitionRefs>
                                            <xpdl:TransitionRef Id="Process_assetmgt_tra96"/>
                                            <xpdl:TransitionRef Id="Process_assetmgt_tra100"/>
                                        </xpdl:TransitionRefs>
                                    </xpdl:Split>
                                </xpdl:TransitionRestriction>
                            </xpdl:TransitionRestrictions>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool4_lan1" ToolId="JaWE" Width="43">
                                    <xpdl:Coordinates XCoordinate="557" YCoordinate="91"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="AM02e-QRCodePrint" Name="AM02e - Goods receipt (QRCodes and Barcodes Print)">
                            <xpdl:Implementation>
                                <xpdl:No/>
                            </xpdl:Implementation>
                            <xpdl:Performers>
                                <xpdl:Performer>currentGroup</xpdl:Performer>
                            </xpdl:Performers>
                            <xpdl:ExtendedAttributes>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Message"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRow"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRowCMDBClass"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRowBrand"/>
                                <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="OrderRowModel"/>
                                <xpdl:ExtendedAttribute Name="createReport" Value="ButtonLabel=&quot;Barcode&quot;&#13;&#10;ReportType=&quot;custom&quot;&#13;&#10;ReportCode=&quot;AM-BarcodePrint&quot;&#13;&#10;IdProcess=ProcessId&#13;&#10;ReadOnlyAttributes=&quot;IdProcess&quot;&#13;&#10;ForcePDF=1"/>
                                <xpdl:ExtendedAttribute Name="openAttachment" Value="ButtonLabel=&quot;QRCode&quot;"/>
                            </xpdl:ExtendedAttributes>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool4_lan1" ToolId="JaWE" Width="90">
                                    <xpdl:Coordinates XCoordinate="959" YCoordinate="89"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                        <xpdl:Activity Id="SYS02d.1-QRCodePrint" Name="SYS02d.1 - Print QRCodes and Barcodes">
                            <xpdl:Implementation>
                                <xpdl:Task>
                                    <xpdl:TaskScript>
                                        <xpdl:Script ScriptType="text/java">import java.awt.Color;
import java.awt.Font;
import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import java.io.File;
import java.io.IOException;
import java.util.Hashtable;

import javax.imageio.ImageIO;

import org.apache.commons.lang3.StringUtils;

import com.google.zxing.BarcodeFormat;
import com.google.zxing.EncodeHintType;
import com.google.zxing.WriterException;
import com.google.zxing.common.BitMatrix;
import com.google.zxing.qrcode.QRCodeWriter;
import com.google.zxing.qrcode.decoder.ErrorCorrectionLevel;

import org.apache.pdfbox.pdmodel.PDDocument;
import org.apache.pdfbox.pdmodel.PDPage;
import org.apache.pdfbox.pdmodel.PDPageContentStream;
import org.apache.pdfbox.pdmodel.graphics.image.JPEGFactory;
import org.apache.pdfbox.pdmodel.graphics.image.PDImageXObject;


String filePath = "/tmp/temp.jpg";
String documentPath = "/tmp/qrcodes.pdf";
String docName = "qrcodes.pdf";

int size = 125;
String fileType = "JPEG";
File myFile = new File(filePath);

int TOP_MARGIN = 30*2;
int LINE_SPACE = 20*2;
int MATRIX_SIZE = 90*2;
int IMAGE_WIDTH = 193*2;
int IMAGE_HEIGHT = 94*2;
int A4_HEIGHT = 600;

final Hashtable hintMap = new Hashtable();
hintMap.put(EncodeHintType.ERROR_CORRECTION, ErrorCorrectionLevel.L);
final QRCodeWriter qrCodeWriter = new QRCodeWriter();

spResult = cmdb.callFunction("wf_assetmgt_linkedhwids")
	.with("processid",ProcessId.intValue());
	

relatedHwList = cmdb.queryRelations(ProcessClass,ProcessId.intValue())
	.withDomain("AssetMgtCI")
	.fetch();



try {
	
	if(relatedHwList!=null) {	
		// initialize position, document and first page
		int heightPosition = A4_HEIGHT;
		PDDocument pdfDoc = new PDDocument();
		PDPage docPage = new PDPage();

		// Start a new content stream which will "hold" the to be created content
		PDPageContentStream contentStream = new PDPageContentStream(pdfDoc, docPage);
	
	
		for (cardRef : relatedHwList) {		
		
			hardware = cmdb.cardFrom(cmdb.referenceTypeFrom(cardRef.getId()));
			classname = hardware.getClassName();
			code = hardware.getCode();
		
			String urlToEncode = "classes/" + classname + "/cards/Code~" + code + "/";
			String fileName = "qrcode_" + classname + "_" + code + ".png";
			String fileDescr = "QR code " + classname + " " + code;
		
			// set url to encode for selected
			final BitMatrix byteMatrix = qrCodeWriter.encode(urlToEncode, BarcodeFormat.QR_CODE, MATRIX_SIZE, MATRIX_SIZE, hintMap);
			final BufferedImage image = new BufferedImage(IMAGE_WIDTH, IMAGE_HEIGHT, BufferedImage.TYPE_INT_RGB);
			image.createGraphics();

			final Graphics2D graphics = (Graphics2D) image.getGraphics();
			graphics.setColor(Color.WHITE);
			graphics.fillRect(0, 0, IMAGE_WIDTH, IMAGE_HEIGHT);
			graphics.setColor(Color.BLACK);
			for (int i = 0; i &lt; MATRIX_SIZE; i++) {
				for (int j = 0; j &lt; MATRIX_SIZE; j++) {
					if (byteMatrix.get(i, j)) {
						graphics.fillRect(i, j, 1, 1);
					}
				}
			}
			String hostname = StringUtils.substring(hardware.get("Hostname"),0,20);

			graphics.setFont(new Font("SansSerif", Font.BOLD, 14));
			graphics.drawString(StringUtils.substring(hostname, 0, 20), MATRIX_SIZE-5, TOP_MARGIN);

			ImageIO.write(image, fileType, myFile);
		
			// convert image to be used in the pdf doc
			PDImageXObject img = JPEGFactory.createFromStream(pdfDoc, new FileInputStream(new File(filePath)));
				
			// if the end of the page is reached, save current stream and change page
			if ( heightPosition&lt;=0 ) {
				contentStream.close();
				pdfDoc.addPage( docPage );
				docPage = new PDPage();
				contentStream = new PDPageContentStream(pdfDoc, docPage);
				heightPosition = A4_HEIGHT;
			}
		
			// draw image in current stream 
			contentStream.drawImage(img,0,heightPosition);
			//update position for next image
			heightPosition = heightPosition - IMAGE_HEIGHT;
			myFile.delete();
		}
		// at the end close the stream and save last page
		contentStream.close();
		pdfDoc.addPage( docPage );
		// save the document 
		pdfDoc.save(documentPath);
	
		File myDoc = new File(documentPath);
		cmdb.existingCard(ProcessClass,ProcessId.intValue()) //
			.attachments() //
			.upload(docName, "Hardware QR code", "Document", myDoc.toURI().toURL().toString());

		myDoc.delete();
	}
	Message = cmdb.selectLookupByCode("ITProc - Message", "AM-DownloadCodes");		
} catch(e) {
	Message = cmdb.selectLookupByCode("ITProc - Message", "AM-ErrorCodes");
}</xpdl:Script>
                                    </xpdl:TaskScript>
                                </xpdl:Task>
                            </xpdl:Implementation>
                            <xpdl:Performers>
                                <xpdl:Performer/>
                            </xpdl:Performers>
                            <xpdl:NodeGraphicsInfos>
                                <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool4_lan1" ToolId="JaWE" Width="90">
                                    <xpdl:Coordinates XCoordinate="790" YCoordinate="87"/>
                                </xpdl:NodeGraphicsInfo>
                            </xpdl:NodeGraphicsInfos>
                        </xpdl:Activity>
                    </xpdl:Activities>
                    <xpdl:Transitions>
                        <xpdl:Transition From="Process_assetmgt_act31" Id="Process_assetmgt_tra95" To="SYSBA03-SetClassName">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="AM02c-GRDelivery1" Id="Process_assetmgt_tra97" To="SYS02c.1-CreateAssets1">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="SYS02c.1-CreateAssets1" Id="Process_assetmgt_tra98" To="Process_assetmgt_act35">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="SYSBA03-SetClassName" Id="Process_assetmgt_tra99" To="AM02c-GRDelivery1">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="SYS02d.1-QRCodePrint" Id="Process_assetmgt_tra27" To="AM02e-QRCodePrint">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="Process_assetmgt_act35" Id="Process_assetmgt_tra96" To="AM02d-CheckAssetsData">
                            <xpdl:Condition Type="OTHERWISE"/>
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="Process_assetmgt_act35" Id="Process_assetmgt_tra100" Name="error" To="AM02c-GRDelivery1">
                            <xpdl:Condition Type="CONDITION">error</xpdl:Condition>
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,102,102" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE">
                                    <xpdl:Coordinates XCoordinate="484" YCoordinate="38"/>
                                </xpdl:ConnectorGraphicsInfo>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="AM02d-CheckAssetsData" Id="Process_assetmgt_tra109" To="SYS02d.1-QRCodePrint">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                        <xpdl:Transition From="AM02e-QRCodePrint" Id="Process_assetmgt_tra110" To="Process_assetmgt_act32">
                            <xpdl:ConnectorGraphicsInfos>
                                <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                            </xpdl:ConnectorGraphicsInfos>
                        </xpdl:Transition>
                    </xpdl:Transitions>
                </xpdl:ActivitySet>
            </xpdl:ActivitySets>
            <xpdl:Activities>
                <xpdl:Activity Id="Process_assetmgt_act1">
                    <xpdl:Event>
                        <xpdl:StartEvent Trigger="None"/>
                    </xpdl:Event>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="102,204,51" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="31">
                            <xpdl:Coordinates XCoordinate="63" YCoordinate="341"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act2">
                    <xpdl:Event>
                        <xpdl:EndEvent Result="None"/>
                    </xpdl:Event>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="31">
                            <xpdl:Coordinates XCoordinate="1554" YCoordinate="92"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM01-ChooseType" Name="AM01 - Choose type">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>"{dbtmpl:AssetMgt-Performers}"</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_ACTION" Value="Type"/>
                        <xpdl:ExtendedAttribute Name="adminStart" Value="true"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="126" YCoordinate="331"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM02a-GRHeader" Name="AM02a - Goods receipt (order header)">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="Supplier"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="Order"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_ACTION" Value="GRHeaderAction"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="420" YCoordinate="66"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM02b1-GROrderRows" Name="AM02b1 - Goods receipt (order rows)">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Message"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Supplier"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Order"/>
                        <xpdl:ExtendedAttribute Name="customForm" Value="ButtonLabel = &quot;Edit order rows&quot;&#13;&#10;ModelType = &quot;Class&quot;&#13;&#10;    ClassModel = &quot;PurchOrderRowTmpl&quot;&#13;&#10;    ClassAttributes = &quot;&quot;&#13;&#10;Layout = &quot;grid&quot;&#13;&#10;DataType = &quot;function&quot;&#13;&#10;&#9;FunctionData = &quot;wf_assetmgt_orderrows&quot;&#13;&#10;orderid=&quot;{server:Order.Id}&quot;&#13;&#10;ReadOnly = &quot;false&quot;&#13;&#10;Required = &quot;true&quot;&#13;&#10;AddDisabled = &quot;true&quot;&#13;&#10;ImportDisabled = &quot;true&quot;&#13;&#10;ExportDisabled = &quot;true&quot;&#13;&#10;ModifyDisabled = &quot;false&quot;&#13;&#10;CloneDisabled = &quot;true&quot;&#13;&#10;SerializationType = &quot;text&quot;&#13;&#10;    KeyValueSeparator = keyvalueSeparator&#13;&#10;    AttributesSeparator = attrSeparator&#13;&#10;    RowsSeparator = rowSeparator&#13;&#10;RefreshBehaviour = &quot;everyTime&quot;&#13;&#10;orderRows"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="727" YCoordinate="73"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM02b2-GRConfirm" Name="AM02b2 - Goods receipt (confirm)">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Message"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATE" Value="Confirm"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="1148" YCoordinate="83"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS01-SetOpeningData" Name="SYS01 - Set opening data">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">import org.joda.time.format.DateTimeFormatter;
import org.joda.time.format.DateTimeFormat;
import org.joda.time.DateTime;
CreationTimestamp = Calendar.getInstance().getTime();
spResultSet = cmdb.callFunction("wf_assetmgt_number").execute();
Number = "AM" + spResultSet.get("number");
ProcessStatus = cmdb.selectLookupByCode("ITProc - ProcessStatus","Execution");
currentGroup =_CurrentGroupName;
SendEmail = true;

dateTime = new DateTime(CreationTimestamp);
DateTimeFormatter fmt = DateTimeFormat.forPattern("dd/MM/yyyy HH:mm:ss");
Description = Number + " - " + Type.getCode() +  " [" + fmt.print(dateTime) + "]";</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="INLINE" Value="INLINE"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="245" YCoordinate="332"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act3">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra34"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra33"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra3"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra50"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra57"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra64"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra74"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra81"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra88"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra102"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="367" YCoordinate="344"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS02c.4-SetClosureData" Name="SYS02c.4 - Set closure data">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">ClosureTimestamp = Calendar.getInstance().getTime();
ProcessStatus = cmdb.selectLookupByCode("ITProc - ProcessStatus","Closed");
Confirm = null;
OrderRow = null;
GRAssetsAction = null;
GRHeaderAction = null;
Message = null;
OrderRowBrand = null;
OrderRowCMDBClass = null;
OrderRowModel = null;
OrderRowQty = null;</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="1415" YCoordinate="79"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act5">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra6"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra8"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="532" YCoordinate="77"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS02a.1-LoadMessage" Name="SYS02a.1 - Load message">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">Message = cmdb.selectLookupByCode("ITProc - Message","AM-OrderRowsInstructions");

orderRows = null;</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="600" YCoordinate="71"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS02b.1-CheckConfirmRequired" Name="SYS02b.1 - Check confirm required">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">Message = null;
String[] parts = orderRows.split("\n");
for(String part : parts){
	if(part.contains("EarlyClosure=true")){
		Message = cmdb.selectLookupByCode("ITProc - Message","AM-ConfirmEarlyClosure");
		break;
	}
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="922" YCoordinate="79"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act6">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra15"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra11"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="1040" YCoordinate="90"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act4">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra16"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra17"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="1303" YCoordinate="93"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS02b.2-UpdateOrderRows" Name="SYS02b.2 - Update order rows">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">eval(loggerLibrary);
Message = null;
Confirm = null;
String[] parts = orderRows.split(rowSeparator);
logger.warn("-----" + orderRows +  "----");
for (String card : parts) {
	if(card == null || card.isEmpty()){
		continue;
	}
	orderRowCard = null;
	int deliveryQuantity = 0;
	boolean earlyClosure = false;
	logger.warn("build card {}",card);
	String[] attributes = card.split(attrSeparator);
	for(String attribute : attributes) {
		logger.warn("deserialize attribute {}",attribute);
		String[] keyValue = attribute.split(keyvalueSeparator); 
		if(keyValue.length &lt; 2){
			continue;
		}
		String name = keyValue[0];
		String value = keyValue[1];
		logger.warn("name is {}",name);
		logger.warn("string value is {}",value);
		if(name.equals("Code")){
			orderRowCard = cmdb.queryClass("PurchaseOrderRow") //
				.with("Order",Order.getId()) //
				.with("Code",value) //
				.fetch()
				.get(0);	
			logger.warn("retrived row with id " + orderRowCard.getId());
		} else if(name.equals("DeliveryQuantity")) {
			deliveryQuantity = Integer.parseInt(value);
			logger.warn("current delivery quantity: " + deliveryQuantity);
		} else if(name.equals("EarlyClosure")) {
			earlyClosure = Boolean.parseBoolean(value);
		}
	}
	cmdb.existingCard("PurchaseOrderRow",orderRowCard.getId()) //
		.with("DeliveryQuantity",deliveryQuantity) //
		.with("EarlyClosure",earlyClosure)			
		.update();
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="1018" YCoordinate="183"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS02b.3-StartIteration" Name="SYS02b.3 - Start iteration">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">eval(loggerLibrary);
exit = true;
orderRowCardList = cmdb.queryClass("PurchaseOrderRow")
					.with("Order",Order.getId())
					.with("EarlyClosure",false)
					.fetch();
stringBuilder = new StringBuilder("");
for(orderRowCard : orderRowCardList){
	if(orderRowCard.get("DeliveryQuantity") &gt; 0 ){
		stringBuilder.append(orderRowCard.getId());
		stringBuilder.append(",");
	}else if(orderRowCard.get("DeliveredQuantity") &lt; orderRowCard.get("Quantity")){
		exit = false; //not completely delivered
	}
}
orderRowsIdList = stringBuilder.toString();
iterator = 0;</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="1019" YCoordinate="295"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act7">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra20"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra21"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="1044" YCoordinate="385"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS02b.4-SelectRow" Name="SYS02b.4 - Select order row">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">String[] parts = orderRowsIdList.split(",");
if(iterator &lt; parts.length){
	orderRowId = Integer.parseInt(parts[(int) iterator]);
	orderRowCard = cmdb.existingCard("PurchaseOrderRow",orderRowId).fetch();
    OrderRowBrand = orderRowCard.get("Brand");
	OrderRowModel = orderRowCard.get("Model");
	OrderRowCMDBClass = orderRowCard.get("CMDBClass");
	OrderRow = cmdb.referenceTypeFrom(orderRowCard);
}else{
	exit = true;
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="1172" YCoordinate="378"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act8">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra22"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra23"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="1043" YCoordinate="518"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS02c.3-OrderDelivered" Name="SYS02c.3 - Order delivered">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">boolean delivered = true;
boolean notdelivered = true;
orderRowCardList = cmdb.queryClass("PurchaseOrderRow")
				.with("Order",Order)
				.fetch();
for(row : orderRowCardList){
	if(row.get("DeliveredQuantity") &lt; row.get("Quantity")){
		delivered = false;
	}
	if(row.get("DeliveredQuantity") &gt; 0){
		notdelivered = false;
	}
}
if(delivered){
	deliveredId = cmdb.selectLookupByCode("PurchaseOrder - State","Delivered").getId();
	cmdb.existingCard("PurchaseOrder",Order.getId())
		.with("State",deliveredId)
		.update();
}else if(notdelivered){
	notDeliveredId = cmdb.selectLookupByCode("PurchaseOrder - State","NotDelivered").getId();
	cmdb.existingCard("PurchaseOrder",Order.getId())
		.with("State",notDeliveredId)
		.update();
}else{
	partDeliveredId = cmdb.selectLookupByCode("PurchaseOrder - State","PartiallyDelivered").getId();
	cmdb.existingCard("PurchaseOrder",Order.getId())
		.with("State",partDeliveredId)
		.update();
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="1415" YCoordinate="175"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS02b.5-CheckFormName" Name="SYS02b.5 - Check form name">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">eval(loggerLibrary);
eval(formLibrary);

error = false;

// select the className and load the form model associated to it
String className = OrderRowCMDBClass.getCode();
formName = findFormName(className);
logger.debug("formName {}", formName);

if(StringUtils.isBlank(formName)) {
	error = true;
	logger.warn("form not found");
	Message = cmdb.selectLookupByCode("ITProc - Message","AM-FormNotFound");
} else {
	formModel = loadFormModel(formName);
	logger.debug("formModel {}", formModel);

	form = cmdb.queryClass("AMForm") //
			.withCode(formName) //
			.fetch() //
			.get(0);

	formFunctionData = form.get("FunctionData");
	formId = form.getId();

	logger.debug("formFunctionData {}", formFunctionData);
	Message = cmdb.selectLookupByCode("ITProc - Message","AM-DeliveredAssetsInstructions");
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Parallel">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra101"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra26"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="1175" YCoordinate="279"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS02c.2-CheckDeliveryCompleted" Name="SYS02c.2 - Check delivery completed">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">orderRowList = cmdb.queryClass("PurchaseOrderRow")
		.with("Order",Order.getId())
		.with("EarlyClosure", false)
		.fetch();
exit = true;

//all rows delivered?
for(row : orderRowList){
	if(row.get("Quantity") &gt; row.get("DeliveredQuantity")){
		exit = false;
	}
	if(!exit){
		break;
	}
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="1673" YCoordinate="407"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act9">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra29"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra30"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="1536" YCoordinate="414"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act10">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra14"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra32"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="1442" YCoordinate="552"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act11">
                    <xpdl:Event>
                        <xpdl:EndEvent Result="None"/>
                    </xpdl:Event>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="31">
                            <xpdl:Coordinates XCoordinate="439" YCoordinate="348"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act12">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra35"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra36"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="842" YCoordinate="85"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM03-Acceptance" Name="AM03 - Acceptance">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstWrhouse"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware to test&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select h.&quot;Id&quot; from &quot;Hardware&quot; h join &quot;LookUp&quot; l on h.&quot;State&quot; = l.&quot;Id&quot; and l.&quot;Status&quot; = 'A' and l.&quot;Code&quot; = 'Acceptance' where h.&quot;Status&quot; = 'A')/)&quot;&#13;&#10;&#13;&#10;selectedHardware"/>
                        <xpdl:ExtendedAttribute Name="openAttachment" Value="ButtonLabel=&quot;Upload attachments&quot;"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="482" YCoordinate="708"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA01-CheckSelection" Name="BA01 - Check selection">
                    <xpdl:BlockActivity ActivitySetId="BA-CheckSelection"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="624" YCoordinate="709"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS13-UpdateAssets" Name="SYS13 - Update assets">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">availableid = cmdb.selectLookupByCode("CI - State","Available").getId();

for(hardware : selectedHardware){
	cmdb.newRelation("AssetMgtCI") //
			.withCard1("AssetMgt", (int) ProcessId) //
			.withCard2("CI", (int) hardware.getId()) //
			.create();

	cmdb.callFunction("wf_assetmgt_direction")
		.with("hardwareid", (int) hardware.getId())
		.with("processid",(int) ProcessId)
		.with("direction","=")
		.execute();
	
	hardwareCard = cmdb.existingCard("CI",hardware.getId())
						.with("State",availableid)
						.with("Room",DstWrhouse);

	wrhouseCard = cmdb.existingCard("Room",DstWrhouse.getId()).fetch();
	if(wrhouseCard.get("Floor").checkValidity()){
		floorCard = cmdb.existingCard("Floor",wrhouseCard.get("Floor").getId()) //
				.fetch();
		hardwareCard.with("Floor",floorCard.getId());
	}
	if(wrhouseCard.get("Building").checkValidity()){
		buildingCard = cmdb.existingCard("Building",wrhouseCard.get("Building").getId()) //
				.fetch();
		hardwareCard.with("Building",buildingCard.getId());
	}
	hardwareCard.update();
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="833" YCoordinate="709"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act15">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra43"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra44"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="760" YCoordinate="717"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act17">
                    <xpdl:Event>
                        <xpdl:EndEvent Result="None"/>
                    </xpdl:Event>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="31">
                            <xpdl:Coordinates XCoordinate="1081" YCoordinate="726"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA02-SetClosureData" Name="BA02 - Set closure data">
                    <xpdl:BlockActivity ActivitySetId="BA-SetClosureData"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="953" YCoordinate="711"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM04-Assignment" Name="AM04 - Assignment">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="OrigWrhouse"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstUser"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstRoom"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATE" Value="SendEmail"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware to assign&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select h.&quot;Id&quot; from &quot;Hardware&quot; h join &quot;LookUp&quot; l on h.&quot;State&quot; = l.&quot;Id&quot; and l.&quot;Status&quot; = 'A' and l.&quot;Code&quot; = 'Available' where h.&quot;Status&quot; = 'A' and h.&quot;Room&quot;::text='{client:OrigWrhouse.Id}')/)&quot;&#13;&#10;&#13;&#10;selectedHardware"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware currently assigned to the user&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select &quot;Id&quot; from &quot;Hardware&quot; where &quot;Assignee&quot;::text = '{client:DstUser.Id}')/)&quot;&#13;&#10;NoSelect=1"/>
                        <xpdl:ExtendedAttribute Name="createModifyCard" Value="ClassName=&quot;Employee&quot;&#13;&#10;ObjId=client:DstUser&#13;&#10;ButtonLabel=&quot;User data&quot;"/>
                        <xpdl:ExtendedAttribute Name="openAttachment" Value="ButtonLabel=&quot;Upload attachments&quot;"/>
                        <xpdl:ExtendedAttribute Name="manageEmail" Value="ButtonLabel=&quot;Email&quot;&#13;&#10;Template = &quot;AM04-Assignment-ToUser&quot;&#13;&#10;Condition=&quot;{client:SendEmail}&quot;"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="483" YCoordinate="817"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA03-CheckSelection" Name="BA03 - Check selection">
                    <xpdl:BlockActivity ActivitySetId="BA-CheckSelection"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="626" YCoordinate="817"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act21">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra53"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra54"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="756" YCoordinate="826"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS14-UpdateAssets" Name="SYS14 - Update assets">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">inuseId = cmdb.selectLookupByCode("CI - State","InUse").getId();

for(hardware : selectedHardware){
	cmdb.newRelation("AssetMgtCI") //
			.withCard1("AssetMgt", (int) ProcessId) //
			.withCard2("CI", (int) hardware.getId()) //
			.create();
	
	cmdb.callFunction("wf_assetmgt_direction")
		.with("hardwareid", (int) hardware.getId())
		.with("processid",(int) ProcessId)
		.with("direction","-")
		.execute();

	hardwareCard = cmdb.existingCard("CI",hardware.getId())
						.with("State",inuseId)
						.with("Assignee",DstUser)
						.with("Room",DstRoom);

	roomCard = cmdb.existingCard("Room",DstRoom.getId()).fetch();
	if(roomCard.get("Floor").checkValidity()){
		floorCard = cmdb.existingCard("Floor",roomCard.get("Floor").getId()) //
				.fetch();
		hardwareCard.with("Floor",floorCard.getId());
	}
	if(roomCard.get("Building").checkValidity()){
		buildingCard = cmdb.existingCard("Building",roomCard.get("Building").getId()) //
				.fetch();
		hardwareCard.with("Building",buildingCard.getId());
	}
	hardwareCard.update();
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="839" YCoordinate="818"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA04-SetClosureData" Name="BA04 - Set closure data">
                    <xpdl:BlockActivity ActivitySetId="BA-SetClosureData"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="960" YCoordinate="820"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act22">
                    <xpdl:Event>
                        <xpdl:EndEvent Result="None"/>
                    </xpdl:Event>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="31">
                            <xpdl:Coordinates XCoordinate="1093" YCoordinate="834"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM05-Withdrawal" Name="AM05 - Withdrawal">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="OrigUser"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstWrhouse"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstStatus"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATE" Value="SendEmail"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware to withdraw&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select h.&quot;Id&quot; from &quot;Hardware&quot; h join &quot;LookUp&quot; l on h.&quot;State&quot; = l.&quot;Id&quot; and l.&quot;Status&quot; = 'A' and l.&quot;Code&quot; = 'InUse' where h.&quot;Status&quot; = 'A' and h.&quot;Assignee&quot;::text='{client:OrigUser.Id}')/)&quot;&#13;&#10;&#13;&#10;selectedHardware"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware currently assigned to the user&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select &quot;Id&quot; from &quot;Hardware&quot; where &quot;Assignee&quot;::text = '{client:OrigUser.Id}')/)&quot;&#13;&#10;NoSelect=1"/>
                        <xpdl:ExtendedAttribute Name="createModifyCard" Value="ClassName=&quot;Employee&quot;&#13;&#10;ObjId=client:OrigUser&#13;&#10;ButtonLabel=&quot;User data&quot;"/>
                        <xpdl:ExtendedAttribute Name="openAttachment" Value="ButtonLabel=&quot;Upload attachments&quot;"/>
                        <xpdl:ExtendedAttribute Name="manageEmail" Value="ButtonLabel=&quot;Email&quot;&#13;&#10;Template = &quot;AM05-Withdrawal-ToUser&quot;&#13;&#10;Condition=&quot;{client:SendEmail}&quot;"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="484" YCoordinate="915"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA05-CheckSelection" Name="BA05 - Check selection">
                    <xpdl:BlockActivity ActivitySetId="BA-CheckSelection"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="627" YCoordinate="917"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act211">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra61"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra60"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="755" YCoordinate="923"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS15-UpdateAssets" Name="SYS15 - Update assets">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">eval(loggerLibrary);
dstStatusCI = cmdb.selectLookupByCode("CI - State",DstStatus.getCode());
if(dstStatusCI == null || !dstStatusCI.checkValidity()){
	logger.warn("Matching lookup with type 'CI - State' not found for destination state " + DstStatus);
}else{
	logger.warn("Lookup converted from '{}' to '{}'",DstStatus,dstStatusCI);
}

for(hardware : selectedHardware){
	cmdb.newRelation("AssetMgtCI") //
			.withCard1("AssetMgt", (int) ProcessId) //
			.withCard2("CI", (int) hardware.getId()) //
			.create();

	cmdb.callFunction("wf_assetmgt_direction")
		.with("hardwareid", (int) hardware.getId())
		.with("processid",(int) ProcessId)
		.with("direction","+")
		.execute();
	
	hardwareCard = cmdb.existingCard("CI",hardware.getId())
						.with("State",dstStatusCI)
						.with("Room",DstWrhouse);
	if(DstStatus.getCode().equals("Available") || DstStatus.getCode().equals("Disused")){
		hardwareCard.with("Assignee", null); 
	}

	wrhouseCard = cmdb.existingCard("Room",DstWrhouse.getId()).fetch();
	if(wrhouseCard.get("Floor").checkValidity()){
		floorCard = cmdb.existingCard("Floor",wrhouseCard.get("Floor").getId()) //
				.fetch();
		hardwareCard.with("Floor",floorCard.getId());
	}
	if(wrhouseCard.get("Building").checkValidity()){
		buildingCard = cmdb.existingCard("Building",wrhouseCard.get("Building").getId()) //
				.fetch();
		hardwareCard.with("Building",buildingCard.getId());
	}

	hardwareCard.update();
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="842" YCoordinate="916"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA06-SetClosureData" Name="BA06 - Set closure data">
                    <xpdl:BlockActivity ActivitySetId="BA-SetClosureData"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="963" YCoordinate="916"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act20">
                    <xpdl:Event>
                        <xpdl:EndEvent Result="None"/>
                    </xpdl:Event>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="31">
                            <xpdl:Coordinates XCoordinate="1096" YCoordinate="930"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM06-Replacement" Name="AM06 - Replacement">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="OrigWrhouse"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstUser"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstRoom"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstWrhouse"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstStatus"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATE" Value="SendEmail"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware to withdraw&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select h.&quot;Id&quot; from &quot;Hardware&quot; h join &quot;LookUp&quot; l on h.&quot;State&quot; = l.&quot;Id&quot; and l.&quot;Status&quot; = 'A' and l.&quot;Code&quot; = 'InUse' where h.&quot;Status&quot; = 'A' and h.&quot;Assignee&quot;::text='{client:DstUser.Id}')/)&quot;&#13;&#10;&#13;&#10;selectedHardwareToWithdraw"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware to assign&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select h.&quot;Id&quot; from &quot;Hardware&quot; h join &quot;LookUp&quot; l on h.&quot;State&quot; = l.&quot;Id&quot; and l.&quot;Status&quot; = 'A' and l.&quot;Code&quot; = 'Available' where h.&quot;Status&quot; = 'A' and h.&quot;Room&quot;::text='{client:OrigWrhouse.Id}')/)&quot;&#13;&#10;&#13;&#10;selectedHardwareToAssign"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware currently assigned to the user&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select &quot;Id&quot; from &quot;Hardware&quot; where &quot;Assignee&quot;::text = '{client:DstUser.Id}')/)&quot;&#13;&#10;NoSelect=1"/>
                        <xpdl:ExtendedAttribute Name="createModifyCard" Value="ClassName=&quot;Employee&quot;&#13;&#10;ObjId=client:DstUser&#13;&#10;ButtonLabel=&quot;User data&quot;"/>
                        <xpdl:ExtendedAttribute Name="openAttachment" Value="ButtonLabel=&quot;Upload attachments&quot;"/>
                        <xpdl:ExtendedAttribute Name="manageEmail" Value="ButtonLabel=&quot;Email&quot;&#13;&#10;Template = &quot;AM06-Replacement-ToUser&quot;&#13;&#10;Condition=&quot;{client:SendEmail}&quot;"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="486" YCoordinate="1017"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act2111">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra67"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra68"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="752" YCoordinate="1031"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS17-UpdateAssets" Name="SYS17 - Update assets">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">eval(loggerLibrary);
dstStatusCI = cmdb.selectLookupByCode("CI - State",DstStatus.getCode());
if(dstStatusCI == null || !dstStatusCI.checkValidity()){
	logger.warn("Matching lookup with type 'CI - State' not found for destination state " + DstStatus);
}

for(hardware : selectedHardwareToWithdraw){
	cmdb.newRelation("AssetMgtCI") //
			.withCard1("AssetMgt", (int) ProcessId) //
			.withCard2("CI", (int) hardware.getId()) //
			.create();

	cmdb.callFunction("wf_assetmgt_direction")
		.with("hardwareid", (int) hardware.getId())
		.with("processid",(int) ProcessId)
		.with("direction","+")
		.execute();

	hardwareCard = cmdb.existingCard("CI",hardware.getId())
						.with("State",dstStatusCI)
						.with("Assignee",null)
						.with("Room",DstWrhouse);
	roomCard = cmdb.existingCard("Room",DstWrhouse.getId()).fetch();
	if(roomCard.get("Floor").checkValidity()){
		floorCard = cmdb.existingCard("Floor",roomCard.get("Floor").getId()) //
				.fetch();
		hardwareCard.with("Floor",floorCard.getId());
	}
	if(roomCard.get("Building").checkValidity()){
		buildingCard = cmdb.existingCard("Building",roomCard.get("Building").getId()) //
				.fetch();
		hardwareCard.with("Building",buildingCard.getId());
	}
	hardwareCard.update();
}

inuseId = cmdb.selectLookupByCode("CI - State","InUse").getId();

for(hardware : selectedHardwareToAssign){
	cmdb.newRelation("AssetMgtCI") //
			.withCard1("AssetMgt", (int) ProcessId) //
			.withCard2("CI", (int) hardware.getId()) //
			.create();

	cmdb.callFunction("wf_assetmgt_direction")
		.with("hardwareid", (int) hardware.getId())
		.with("processid",(int) ProcessId)
		.with("direction","-")
		.execute();
	
	hardwareCard = cmdb.existingCard("CI",hardware.getId())
						.with("State",inuseId)
						.with("Assignee",DstUser)
						.with("Room",DstRoom);

	roomCard = cmdb.existingCard("Room",DstRoom.getId()).fetch();
	if(roomCard.get("Floor").checkValidity()){
		floorCard = cmdb.existingCard("Floor",roomCard.get("Floor").getId()) //
				.fetch();
		hardwareCard.with("Floor",floorCard.getId());
	}
	if(roomCard.get("Building").checkValidity()){
		buildingCard = cmdb.existingCard("Building",roomCard.get("Building").getId()) //
				.fetch();
		hardwareCard.with("Building",buildingCard.getId());
	}
	hardwareCard.update();
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="1045" YCoordinate="1025"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA07-SetClosureData" Name="BA07 - Set closure data">
                    <xpdl:BlockActivity ActivitySetId="BA-SetClosureData"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="1165" YCoordinate="1026"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act23">
                    <xpdl:Event>
                        <xpdl:EndEvent Result="None"/>
                    </xpdl:Event>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="31">
                            <xpdl:Coordinates XCoordinate="1286" YCoordinate="1040"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS16-CheckSelection" Name="SYS16 - Check selection">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">Message = null;
if((selectedHardwareToAssign == null || selectedHardwareToAssign.length == 0) || (selectedHardwareToWithdraw == null || selectedHardwareToWithdraw.length == null)){
	Message = cmdb.selectLookupByCode("ITProc - Message","AM-EmptySelectionForReplacement");
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="627" YCoordinate="1020"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM14-ConfirmSelection" Name="AM14 - Confirm selection">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Message"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATE" Value="Confirm"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="849" YCoordinate="1024"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act26">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra72"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra73"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="968" YCoordinate="1033"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM07-TransferBtwUsers" Name="AM07 - Transfer between users">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="OrigUser"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstUser"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstRoom"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATE" Value="SendEmail"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware to move&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select h.&quot;Id&quot; from &quot;Hardware&quot; h where h.&quot;Status&quot; = 'A' and h.&quot;Assignee&quot;::text='{client:OrigUser.Id}')/)&quot;&#13;&#10;&#13;&#10;selectedHardware"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware assigned to orig. user&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select &quot;Id&quot; from &quot;Hardware&quot; where &quot;Assignee&quot;::text = '{client:OrigUser.Id}')/)&quot;&#13;&#10;NoSelect=1"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware assigned to dest. user&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select &quot;Id&quot; from &quot;Hardware&quot; where &quot;Assignee&quot;::text = '{client:DstUser.Id}')/)&quot;&#13;&#10;NoSelect=1"/>
                        <xpdl:ExtendedAttribute Name="createModifyCard" Value="ClassName=&quot;Employee&quot;&#13;&#10;ObjId=client:OrigUser&#13;&#10;ButtonLabel=&quot;Orig. user data&quot;"/>
                        <xpdl:ExtendedAttribute Name="createModifyCard" Value="ClassName=&quot;Employee&quot;&#13;&#10;ObjId=client:DstUser&#13;&#10;ButtonLabel=&quot;Dest. user data&quot;"/>
                        <xpdl:ExtendedAttribute Name="openAttachment" Value="ButtonLabel=&quot;Upload attachments&quot;"/>
                        <xpdl:ExtendedAttribute Name="manageEmail" Value="ButtonLabel=&quot;Email&quot;&#13;&#10;&#13;&#10;Template1 = &quot;AM07-Transfer-ToOrigUser&quot;&#13;&#10;Condition1=&quot;{client:SendEmail}&quot;&#13;&#10;&#13;&#10;Template2 = &quot;AM07-Transfer-ToDstUser&quot;&#13;&#10;Condition2=&quot;{client:SendEmail}&quot;"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="488" YCoordinate="1120"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA08-CheckSelection" Name="BA08 - Check selection">
                    <xpdl:BlockActivity ActivitySetId="BA-CheckSelection"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="623" YCoordinate="1123"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act24">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra77"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra80"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="747" YCoordinate="1131"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS18-UpdateAssets" Name="SYS18 - Update assets">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">inuseId = cmdb.selectLookupByCode("CI - State","InUse").getId();

for(hardware : selectedHardware){
	cmdb.newRelation("AssetMgtCI") //
			.withCard1("AssetMgt", (int) ProcessId) //
			.withCard2("CI", (int) hardware.getId()) //
			.create();

	cmdb.callFunction("wf_assetmgt_direction")
		.with("hardwareid", (int) hardware.getId())
		.with("processid",(int) ProcessId)
		.with("direction","=")
		.execute();
	
	hardwareCard = cmdb.existingCard("CI",hardware.getId())
						.with("State",inuseId)
						.with("Assignee",DstUser)
						.with("Room",DstRoom);

	roomCard = cmdb.existingCard("Room",DstRoom.getId()).fetch();
	if(roomCard.get("Floor").checkValidity()){
		floorCard = cmdb.existingCard("Floor",roomCard.get("Floor").getId()) //
				.fetch();
		hardwareCard.with("Floor",floorCard.getId());
	}
	if(roomCard.get("Building").checkValidity()){
		buildingCard = cmdb.existingCard("Building",roomCard.get("Building").getId()) //
				.fetch();
		hardwareCard.with("Building",buildingCard.getId());
	}

	hardwareCard.update();
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="844" YCoordinate="1123"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA09-SetClosureData" Name="BA09 - Set closure data">
                    <xpdl:BlockActivity ActivitySetId="BA-SetClosureData"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="969" YCoordinate="1126"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act25">
                    <xpdl:Event>
                        <xpdl:EndEvent Result="None"/>
                    </xpdl:Event>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="31">
                            <xpdl:Coordinates XCoordinate="1089" YCoordinate="1142"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM08-TransferBtwWrhouses" Name="AM08 - Transfer between warehouses">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="OrigWrhouse"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstWrhouse"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstStatus"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware to move&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select h.&quot;Id&quot; from &quot;Hardware&quot; h where h.&quot;Status&quot; = 'A' and h.&quot;Room&quot;::text='{client:OrigWrhouse.Id}')/)&quot;&#13;&#10;&#13;&#10;selectedHardware"/>
                        <xpdl:ExtendedAttribute Name="openAttachment" Value="ButtonLabel=&quot;Upload attachments&quot;"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="485" YCoordinate="1221"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA10-CheckSelection" Name="BA10 - Check selection">
                    <xpdl:BlockActivity ActivitySetId="BA-CheckSelection"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="620" YCoordinate="1221"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act27">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra84"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra85"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="764" YCoordinate="1231"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS19-UpdateAssets" Name="SYS19 - Update assets">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">eval(loggerLibrary);
dstStatusCI = cmdb.selectLookupByCode("CI - State",DstStatus.getCode());
if(dstStatusCI == null || !dstStatusCI.checkValidity()){
	logger.warn("Matching lookup with type 'CI - State' not found for destination state " + DstStatus);
}else{
	logger.warn("Lookup converted from '{}' to '{}'",DstStatus,dstStatusCI);
}

for(hardware : selectedHardware){
	cmdb.newRelation("AssetMgtCI") //
			.withCard1("AssetMgt", (int) ProcessId) //
			.withCard2("CI", (int) hardware.getId()) //
			.create();

	cmdb.callFunction("wf_assetmgt_direction")
		.with("hardwareid", (int) hardware.getId())
		.with("processid",(int) ProcessId)
		.with("direction","=")
		.execute();
	
	hardwareCard = cmdb.existingCard("CI",hardware.getId())
						.with("State",dstStatusCI)
						.with("Room",DstWrhouse);

	wrhouseCard = cmdb.existingCard("Room",DstWrhouse.getId()).fetch();
	if(wrhouseCard.get("Floor").checkValidity()){
		floorCard = cmdb.existingCard("Floor",wrhouseCard.get("Floor").getId()) //
				.fetch();
		hardwareCard.with("Floor",floorCard.getId());
	}
	if(wrhouseCard.get("Building").checkValidity()){
		buildingCard = cmdb.existingCard("Building",wrhouseCard.get("Building").getId()) //
				.fetch();
		hardwareCard.with("Building",buildingCard.getId());
	}

	hardwareCard.update();
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="847" YCoordinate="1222"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA11-SetClosureData" Name="BA11 - Set closure data">
                    <xpdl:BlockActivity ActivitySetId="BA-SetClosureData"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="967" YCoordinate="1221"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act28">
                    <xpdl:Event>
                        <xpdl:EndEvent Result="None"/>
                    </xpdl:Event>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="31">
                            <xpdl:Coordinates XCoordinate="1085" YCoordinate="1233"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM09-MoveUser" Name="AM09 - Move user">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="OrigUser"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="DstRoom"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware to move&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select h.&quot;Id&quot; from &quot;Hardware&quot; h where h.&quot;Status&quot; = 'A' and h.&quot;Assignee&quot;::text='{client:OrigUser.Id}')/)&quot;&#13;&#10;DefaultSelection=&quot;from Hardware where Id in (/(select h.&quot;Id&quot; from &quot;Hardware&quot; h where h.&quot;Status&quot; = 'A' and h.&quot;Assignee&quot;::text='{client:OrigUser.Id}')/)&quot;&#13;&#10;&#13;&#10;selectedHardware"/>
                        <xpdl:ExtendedAttribute Name="createModifyCard" Value="ClassName=&quot;Employee&quot;&#13;&#10;ObjId=client:OrigUser&#13;&#10;ButtonLabel=&quot;User data&quot;"/>
                        <xpdl:ExtendedAttribute Name="openAttachment" Value="ButtonLabel=&quot;Upload attachments&quot;"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="484" YCoordinate="1314"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA12-CheckSelection" Name="BA12 - Check selection">
                    <xpdl:BlockActivity ActivitySetId="BA-CheckSelection"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="618" YCoordinate="1315"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act29">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra91"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra92"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="764" YCoordinate="1324"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS20-UpdateAssets" Name="SYS20 - Update assets">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">for(hardware : selectedHardware){
	cmdb.newRelation("AssetMgtCI") //
			.withCard1("AssetMgt", (int) ProcessId) //
			.withCard2("CI", (int) hardware.getId()) //
			.create();

	cmdb.callFunction("wf_assetmgt_direction")
		.with("hardwareid", (int) hardware.getId())
		.with("processid",(int) ProcessId)
		.with("direction","=")
		.execute();
	
	hardwareCard = cmdb.existingCard("CI",hardware.getId())
						.with("Room",DstRoom);

	roomCard = cmdb.existingCard("Room",DstRoom.getId()).fetch();
	if(roomCard.get("Floor").checkValidity()){
		floorCard = cmdb.existingCard("Floor",roomCard.get("Floor").getId()) //
				.fetch();
		hardwareCard.with("Floor",floorCard.getId());
	}
	if(roomCard.get("Building").checkValidity()){
		buildingCard = cmdb.existingCard("Building",roomCard.get("Building").getId()) //
				.fetch();
		hardwareCard.with("Building",buildingCard.getId());
	}

	hardwareCard.update();
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="844" YCoordinate="1315"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA13-SetClosureData" Name="BA13 - Set closure data">
                    <xpdl:BlockActivity ActivitySetId="BA-SetClosureData"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="971" YCoordinate="1314"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act30">
                    <xpdl:Event>
                        <xpdl:EndEvent Result="None"/>
                    </xpdl:Event>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="31">
                            <xpdl:Coordinates XCoordinate="1094" YCoordinate="1327"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="AM10-Disposal" Name="AM10 - Disposal">
                    <xpdl:Implementation>
                        <xpdl:No/>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer>currentGroup</xpdl:Performer>
                    </xpdl:Performers>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Join Type="Exclusive"/>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:ExtendedAttributes>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="Number"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_VIEW" Value="CreationTimestamp"/>
                        <xpdl:ExtendedAttribute Name="VariableToProcess_UPDATEREQUIRED" Value="OrigWrhouse"/>
                        <xpdl:ExtendedAttribute Name="linkCards" Value="ClassName=&quot;Hardware&quot;&#13;&#10;ButtonLabel=&quot;Hardware to dispose&quot;&#13;&#10;Filter=&quot;from Hardware where Id in (/(select h.&quot;Id&quot; from &quot;Hardware&quot; h join &quot;LookUp&quot; l on l.&quot;Id&quot; = h.&quot;State&quot; and l.&quot;Code&quot; = 'Disused' where h.&quot;Status&quot; = 'A' and h.&quot;Room&quot;::text='{client:OrigWrhouse.Id}')/)&quot;&#13;&#10;&#13;&#10;selectedHardware"/>
                        <xpdl:ExtendedAttribute Name="openAttachment" Value="ButtonLabel=&quot;Upload attachments&quot;"/>
                    </xpdl:ExtendedAttributes>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="187,247,190" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="489" YCoordinate="1416"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA14-CheckSelection" Name="BA14 - Check selection">
                    <xpdl:BlockActivity ActivitySetId="BA-CheckSelection"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="618" YCoordinate="1415"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act33">
                    <xpdl:Route GatewayType="Exclusive"/>
                    <xpdl:TransitionRestrictions>
                        <xpdl:TransitionRestriction>
                            <xpdl:Split Type="Exclusive">
                                <xpdl:TransitionRefs>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra106"/>
                                    <xpdl:TransitionRef Id="Process_assetmgt_tra105"/>
                                </xpdl:TransitionRefs>
                            </xpdl:Split>
                        </xpdl:TransitionRestriction>
                    </xpdl:TransitionRestrictions>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,229,124" Height="43" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="43">
                            <xpdl:Coordinates XCoordinate="764" YCoordinate="1423"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="SYS21-UpdateAssets" Name="SYS21 - Update assets">
                    <xpdl:Implementation>
                        <xpdl:Task>
                            <xpdl:TaskScript>
                                <xpdl:Script ScriptType="text/java">disposedId = cmdb.selectLookupByCode("CI - State","Disposed");

for(hardware : selectedHardware){
	cmdb.newRelation("AssetMgtCI") //
			.withCard1("AssetMgt", (int) ProcessId) //
			.withCard2("CI", (int) hardware.getId()) //
			.create();

	cmdb.callFunction("wf_assetmgt_direction")
		.with("hardwareid", (int) hardware.getId())
		.with("processid",(int) ProcessId)
		.with("direction","-")
		.execute();
	
	hardwareCard = cmdb.existingCard("CI",hardware.getId())
						.with("Building",null)
						.with("Floor",null)
						.with("Room",null)
						.with("Assignee",null)
						.with("Availability",null)
						.with("State",disposedId);
	hardwareCard.update();
}</xpdl:Script>
                            </xpdl:TaskScript>
                        </xpdl:Task>
                    </xpdl:Implementation>
                    <xpdl:Performers>
                        <xpdl:Performer/>
                    </xpdl:Performers>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,255,204" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="858" YCoordinate="1415"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA17-SetClosureData" Name="BA17 - Set closure data">
                    <xpdl:BlockActivity ActivitySetId="BA-SetClosureData"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="982" YCoordinate="1415"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="Process_assetmgt_act34">
                    <xpdl:Event>
                        <xpdl:EndEvent Result="None"/>
                    </xpdl:Event>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="236,120,98" Height="31" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="31">
                            <xpdl:Coordinates XCoordinate="1104" YCoordinate="1429"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
                <xpdl:Activity Id="BA03-CreateAssets" Name="BA03 - Create assets">
                    <xpdl:BlockActivity ActivitySetId="BA-AssetData"/>
                    <xpdl:NodeGraphicsInfos>
                        <xpdl:NodeGraphicsInfo BorderColor="0,0,0" FillColor="255,165,121" Height="60" IsVisible="true" LaneId="Package_assetmgt_pool1_lan1" ToolId="JaWE" Width="90">
                            <xpdl:Coordinates XCoordinate="1511" YCoordinate="280"/>
                        </xpdl:NodeGraphicsInfo>
                    </xpdl:NodeGraphicsInfos>
                </xpdl:Activity>
            </xpdl:Activities>
            <xpdl:Transitions>
                <xpdl:Transition From="Process_assetmgt_act1" Id="Process_assetmgt_tra1" To="AM01-ChooseType">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act3" Id="Process_assetmgt_tra3" To="AM02a-GRHeader">
                    <xpdl:Condition Type="CONDITION">"GoodReceipt".equals(Type.getCode())</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="425" YCoordinate="91"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS01-SetOpeningData" Id="Process_assetmgt_tra4" To="Process_assetmgt_act3">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM02a-GRHeader" Id="Process_assetmgt_tra5" To="Process_assetmgt_act5">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act5" Id="Process_assetmgt_tra6" Name="close" To="SYS02c.4-SetClosureData">
                    <xpdl:Condition Type="CONDITION">GRHeaderAction.getCode().equals("Close")</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="586" YCoordinate="262"/>
                            <xpdl:Coordinates XCoordinate="1402" YCoordinate="259"/>
                            <xpdl:Coordinates XCoordinate="1402" YCoordinate="128"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS02c.4-SetClosureData" Id="Process_assetmgt_tra7" To="Process_assetmgt_act2">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act5" Id="Process_assetmgt_tra8" To="SYS02a.1-LoadMessage">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS02a.1-LoadMessage" Id="Process_assetmgt_tra9" To="AM02b1-GROrderRows">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS02b.4-SelectRow" Id="Process_assetmgt_tra10" To="SYS02b.5-CheckFormName">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act6" Id="Process_assetmgt_tra11" To="AM02b2-GRConfirm">
                    <xpdl:Condition Type="CONDITION">Message != null &amp;&amp; Message.checkValidity()</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS02b.1-CheckConfirmRequired" Id="Process_assetmgt_tra12" To="Process_assetmgt_act6">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM02b2-GRConfirm" Id="Process_assetmgt_tra13" To="Process_assetmgt_act4">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act6" Id="Process_assetmgt_tra15" Name="no confirm required" To="SYS02b.2-UpdateOrderRows">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act4" Id="Process_assetmgt_tra16" To="AM02b1-GROrderRows">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="1359" YCoordinate="23"/>
                            <xpdl:Coordinates XCoordinate="800" YCoordinate="21"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act4" Id="Process_assetmgt_tra17" Name="confirm early closure" To="SYS02b.2-UpdateOrderRows">
                    <xpdl:Condition Type="CONDITION">Confirm</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="1359" YCoordinate="218"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS02b.2-UpdateOrderRows" Id="Process_assetmgt_tra18" To="SYS02b.3-StartIteration">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS02b.3-StartIteration" Id="Process_assetmgt_tra19" To="Process_assetmgt_act7">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act7" Id="Process_assetmgt_tra20" Name="at least one row" To="SYS02b.4-SelectRow">
                    <xpdl:Condition Type="CONDITION">orderRowsIdList != null &amp;&amp; !orderRowsIdList.isEmpty() &amp;&amp; !",".equals(orderRowsIdList) &amp;&amp; orderRowsIdList.split(",").length &gt; 0</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act7" Id="Process_assetmgt_tra21" To="Process_assetmgt_act8">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act8" Id="Process_assetmgt_tra22" Name="still rows not delivered" To="SYS02a.1-LoadMessage">
                    <xpdl:Condition Type="CONDITION">!exit</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="695" YCoordinate="541"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act8" Id="Process_assetmgt_tra23" To="SYS02c.3-OrderDelivered">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="1482" YCoordinate="540"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS02c.3-OrderDelivered" Id="Process_assetmgt_tra24" To="SYS02c.4-SetClosureData">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act9" Id="Process_assetmgt_tra29" Name="loop completed" To="SYS02c.2-CheckDeliveryCompleted">
                    <xpdl:Condition Type="CONDITION">iterator == orderRowsIdList.split(",").length</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA03-CreateAssets" Id="Process_assetmgt_tra28" To="Process_assetmgt_act9">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act9" Id="Process_assetmgt_tra30" To="SYS02b.4-SelectRow">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="1592" YCoordinate="480"/>
                            <xpdl:Coordinates XCoordinate="1256" YCoordinate="479"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS02c.2-CheckDeliveryCompleted" Id="Process_assetmgt_tra31" To="Process_assetmgt_act10">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="1762" YCoordinate="572"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act10" Id="Process_assetmgt_tra32" Name="no more rows" To="SYS02c.3-OrderDelivered">
                    <xpdl:Condition Type="CONDITION">exit</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act3" Id="Process_assetmgt_tra34" To="Process_assetmgt_act11">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act12" Id="Process_assetmgt_tra35" To="SYS02b.1-CheckConfirmRequired">
                    <xpdl:Condition Type="CONDITION">orderRows != null &amp;&amp; !orderRows.isEmpty()</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act12" Id="Process_assetmgt_tra36" Name="no rows" To="SYS02c.4-SetClosureData">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="898" YCoordinate="35"/>
                            <xpdl:Coordinates XCoordinate="1491" YCoordinate="34"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act10" Id="Process_assetmgt_tra14" To="SYS02a.1-LoadMessage">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="684" YCoordinate="576"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act3" Id="Process_assetmgt_tra33" To="AM03-Acceptance">
                    <xpdl:Condition Type="CONDITION">"Acceptance".equals(Type.getCode())</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="446" YCoordinate="735"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM03-Acceptance" Id="Process_assetmgt_tra42" To="BA01-CheckSelection">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act15" Id="Process_assetmgt_tra44" To="SYS13-UpdateAssets">
                    <xpdl:Condition Type="CONDITION">Confirm || Message == null</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA01-CheckSelection" Id="Process_assetmgt_tra45" To="Process_assetmgt_act15">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act15" Id="Process_assetmgt_tra43" To="AM03-Acceptance">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="703" YCoordinate="676"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS13-UpdateAssets" Id="Process_assetmgt_tra48" To="BA02-SetClosureData">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA02-SetClosureData" Id="Process_assetmgt_tra49" To="Process_assetmgt_act17">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act3" Id="Process_assetmgt_tra50" To="AM04-Assignment">
                    <xpdl:Condition Type="CONDITION">"Assignment".equals(Type.getCode())</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="438" YCoordinate="845"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM04-Assignment" Id="Process_assetmgt_tra51" To="BA03-CheckSelection">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA03-CheckSelection" Id="Process_assetmgt_tra52" To="Process_assetmgt_act21">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act21" Id="Process_assetmgt_tra54" To="AM04-Assignment">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="706" YCoordinate="786"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act21" Id="Process_assetmgt_tra53" To="SYS14-UpdateAssets">
                    <xpdl:Condition Type="CONDITION">Confirm || Message == null</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS14-UpdateAssets" Id="Process_assetmgt_tra55" To="BA04-SetClosureData">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA04-SetClosureData" Id="Process_assetmgt_tra56" To="Process_assetmgt_act22">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act3" Id="Process_assetmgt_tra57" To="AM05-Withdrawal">
                    <xpdl:Condition Type="CONDITION">"Withdrawal".equals(Type.getCode())</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="431" YCoordinate="945"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA05-CheckSelection" Id="Process_assetmgt_tra58" To="Process_assetmgt_act211">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM05-Withdrawal" Id="Process_assetmgt_tra59" To="BA05-CheckSelection">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act211" Id="Process_assetmgt_tra60" To="AM05-Withdrawal">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="705" YCoordinate="892"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act211" Id="Process_assetmgt_tra61" To="SYS15-UpdateAssets">
                    <xpdl:Condition Type="CONDITION">Confirm || Message == null</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS15-UpdateAssets" Id="Process_assetmgt_tra62" To="BA06-SetClosureData">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA06-SetClosureData" Id="Process_assetmgt_tra63" To="Process_assetmgt_act20">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act3" Id="Process_assetmgt_tra64" To="AM06-Replacement">
                    <xpdl:Condition Type="CONDITION">"Replacement".equals(Type.getCode())</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="426" YCoordinate="1050"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS17-UpdateAssets" Id="Process_assetmgt_tra69" To="BA07-SetClosureData">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA07-SetClosureData" Id="Process_assetmgt_tra70" To="Process_assetmgt_act23">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM06-Replacement" Id="Process_assetmgt_tra65" To="SYS16-CheckSelection">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS16-CheckSelection" Id="Process_assetmgt_tra66" To="Process_assetmgt_act2111">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act2111" Id="Process_assetmgt_tra67" To="AM14-ConfirmSelection">
                    <xpdl:Condition Type="CONDITION">Message != null</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act2111" Id="Process_assetmgt_tra68" To="SYS17-UpdateAssets">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="948" YCoordinate="996"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM14-ConfirmSelection" Id="Process_assetmgt_tra71" To="Process_assetmgt_act26">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act26" Id="Process_assetmgt_tra72" To="SYS17-UpdateAssets">
                    <xpdl:Condition Type="CONDITION">Confirm</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act26" Id="Process_assetmgt_tra73" To="AM06-Replacement">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="873" YCoordinate="988"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act3" Id="Process_assetmgt_tra74" To="AM07-TransferBtwUsers">
                    <xpdl:Condition Type="CONDITION">"TransferBtwUsers".equals(Type.getCode())</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="418" YCoordinate="1148"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM07-TransferBtwUsers" Id="Process_assetmgt_tra75" To="BA08-CheckSelection">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA08-CheckSelection" Id="Process_assetmgt_tra76" To="Process_assetmgt_act24">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act24" Id="Process_assetmgt_tra77" To="SYS18-UpdateAssets">
                    <xpdl:Condition Type="CONDITION">Confirm || Message == null</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS18-UpdateAssets" Id="Process_assetmgt_tra78" To="BA09-SetClosureData">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA09-SetClosureData" Id="Process_assetmgt_tra79" To="Process_assetmgt_act25">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act24" Id="Process_assetmgt_tra80" To="AM07-TransferBtwUsers">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="696" YCoordinate="1097"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act3" Id="Process_assetmgt_tra81" To="AM08-TransferBtwWrhouses">
                    <xpdl:Condition Type="CONDITION">"TransferBtwWarehouses".equals(Type.getCode())</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="407" YCoordinate="1250"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM08-TransferBtwWrhouses" Id="Process_assetmgt_tra82" To="BA10-CheckSelection">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA10-CheckSelection" Id="Process_assetmgt_tra83" To="Process_assetmgt_act27">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act27" Id="Process_assetmgt_tra84" To="AM08-TransferBtwWrhouses">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="699" YCoordinate="1199"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act27" Id="Process_assetmgt_tra85" To="SYS19-UpdateAssets">
                    <xpdl:Condition Type="CONDITION">Confirm || Message == null</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS19-UpdateAssets" Id="Process_assetmgt_tra86" To="BA11-SetClosureData">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA11-SetClosureData" Id="Process_assetmgt_tra87" To="Process_assetmgt_act28">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act3" Id="Process_assetmgt_tra88" To="AM09-MoveUser">
                    <xpdl:Condition Type="CONDITION">"MoveUser".equals(Type.getCode())</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="400" YCoordinate="1340"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM09-MoveUser" Id="Process_assetmgt_tra89" To="BA12-CheckSelection">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA12-CheckSelection" Id="Process_assetmgt_tra90" To="Process_assetmgt_act29">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act29" Id="Process_assetmgt_tra91" To="AM09-MoveUser">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="720" YCoordinate="1298"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act29" Id="Process_assetmgt_tra92" To="SYS20-UpdateAssets">
                    <xpdl:Condition Type="CONDITION">Confirm || Message == null</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS20-UpdateAssets" Id="Process_assetmgt_tra93" To="BA13-SetClosureData">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA13-SetClosureData" Id="Process_assetmgt_tra94" To="Process_assetmgt_act30">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act3" Id="Process_assetmgt_tra102" To="AM10-Disposal">
                    <xpdl:Condition Type="CONDITION">"Disposal".equals(Type.getCode())</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="445" YCoordinate="1449"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM10-Disposal" Id="Process_assetmgt_tra103" To="BA14-CheckSelection">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA14-CheckSelection" Id="Process_assetmgt_tra104" To="Process_assetmgt_act33">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act33" Id="Process_assetmgt_tra105" To="AM10-Disposal">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="699" YCoordinate="1392"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="Process_assetmgt_act33" Id="Process_assetmgt_tra106" To="SYS21-UpdateAssets">
                    <xpdl:Condition Type="CONDITION">Confirm || Message == null</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS21-UpdateAssets" Id="Process_assetmgt_tra107" To="BA17-SetClosureData">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="BA17-SetClosureData" Id="Process_assetmgt_tra108" To="Process_assetmgt_act34">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM01-ChooseType" Id="Process_assetmgt_tra2" To="SYS01-SetOpeningData">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS02b.5-CheckFormName" Id="Process_assetmgt_tra101" To="AM02b1-GROrderRows">
                    <xpdl:Condition Type="OTHERWISE"/>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="255,128,0" IsVisible="true" Style="NO_ROUTING_ORTHOGONAL" ToolId="JaWE">
                            <xpdl:Coordinates XCoordinate="806" YCoordinate="284"/>
                        </xpdl:ConnectorGraphicsInfo>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="SYS02b.5-CheckFormName" Id="Process_assetmgt_tra26" To="BA03-CreateAssets">
                    <xpdl:Condition Type="CONDITION">!error</xpdl:Condition>
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,153,153" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
                <xpdl:Transition From="AM02b1-GROrderRows" Id="Process_assetmgt_tra25" To="Process_assetmgt_act12">
                    <xpdl:ConnectorGraphicsInfos>
                        <xpdl:ConnectorGraphicsInfo FillColor="0,0,0" IsVisible="true" Style="NO_ROUTING_SPLINE" ToolId="JaWE"/>
                    </xpdl:ConnectorGraphicsInfos>
                </xpdl:Transition>
            </xpdl:Transitions>
            <xpdl:ExtendedAttributes>
                <xpdl:ExtendedAttribute Name="cmdbuildBindToClass" Value="AssetMgt"/>
            </xpdl:ExtendedAttributes>
        </xpdl:WorkflowProcess>
    </xpdl:WorkflowProcesses>
    <xpdl:ExtendedAttributes>
        <xpdl:ExtendedAttribute Name="EDITING_TOOL" Value="Together Workflow Editor"/>
        <xpdl:ExtendedAttribute Name="EDITING_TOOL_VERSION" Value="4.4-1-20120111-0622"/>
        <xpdl:ExtendedAttribute Name="JaWE_CONFIGURATION" Value="shark"/>
    </xpdl:ExtendedAttributes>
</xpdl:Package>

THREE.TrackballControls=function(H,G){var u=this;var w={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=H;this.domElement=(G!==undefined)?G:document;this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3();var m=0.000001;var l=new THREE.Vector3();var x=w.NONE,p=w.NONE,a=new THREE.Vector3(),q=new THREE.Vector2(),C=new THREE.Vector2(),F=new THREE.Vector3(),b=0,n=new THREE.Vector2(),A=new THREE.Vector2(),k=0,d=0,f=new THREE.Vector2(),z=new THREE.Vector2();this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var E={type:"change"};var o={type:"start"};var j={type:"end"};this.handleResize=function(){if(this.domElement===document){this.screen.left=0;this.screen.top=0;this.screen.width=window.innerWidth;this.screen.height=window.innerHeight}else{var I=this.domElement.getBoundingClientRect();var J=this.domElement.ownerDocument.documentElement;this.screen.left=I.left+window.pageXOffset-J.clientLeft;this.screen.top=I.top+window.pageYOffset-J.clientTop;this.screen.width=I.width;this.screen.height=I.height}};var c=(function(){var J=new THREE.Vector2();return function I(L,K){J.set((L-u.screen.left)/u.screen.width,(K-u.screen.top)/u.screen.height);return J}}());var e=(function(){var I=new THREE.Vector2();return function J(L,K){I.set(((L-u.screen.width*0.5-u.screen.left)/(u.screen.width*0.5)),((u.screen.height+2*(u.screen.top-K))/u.screen.width));return I}}());this.rotateCamera=(function(){var M=new THREE.Vector3(),O=new THREE.Quaternion(),N=new THREE.Vector3(),J=new THREE.Vector3(),I=new THREE.Vector3(),L=new THREE.Vector3(),P;return function K(){L.set(C.x-q.x,C.y-q.y,0);P=L.length();if(P){a.copy(u.object.position).sub(u.target);N.copy(a).normalize();J.copy(u.object.up).normalize();I.crossVectors(J,N).normalize();J.setLength(C.y-q.y);I.setLength(C.x-q.x);L.copy(J.add(I));M.crossVectors(L,a).normalize();P*=u.rotateSpeed;O.setFromAxisAngle(M,P);a.applyQuaternion(O);u.object.up.applyQuaternion(O);F.copy(M);b=P}else{if(!u.staticMoving&&b){b*=Math.sqrt(1-u.dynamicDampingFactor);a.copy(u.object.position).sub(u.target);O.setFromAxisAngle(F,b);a.applyQuaternion(O);u.object.up.applyQuaternion(O)}}q.copy(C)}}());this.zoomCamera=function(){var I;if(x===w.TOUCH_ZOOM_PAN){I=k/d;k=d;a.multiplyScalar(I)}else{I=1+(A.y-n.y)*u.zoomSpeed;if(I!==1&&I>0){a.multiplyScalar(I)}if(u.staticMoving){n.copy(A)}else{n.y+=(A.y-n.y)*this.dynamicDampingFactor}}};this.panCamera=(function(){var K=new THREE.Vector2(),I=new THREE.Vector3(),L=new THREE.Vector3();return function J(){K.copy(z).sub(f);if(K.lengthSq()){K.multiplyScalar(a.length()*u.panSpeed);L.copy(a).cross(u.object.up).setLength(K.x);L.add(I.copy(u.object.up).setLength(K.y));u.object.position.add(L);u.target.add(L);if(u.staticMoving){f.copy(z)}else{f.add(K.subVectors(z,f).multiplyScalar(u.dynamicDampingFactor))}}}}());this.checkDistances=function(){if(!u.noZoom||!u.noPan){if(a.lengthSq()>u.maxDistance*u.maxDistance){u.object.position.addVectors(u.target,a.setLength(u.maxDistance));n.copy(A)}if(a.lengthSq()<u.minDistance*u.minDistance){u.object.position.addVectors(u.target,a.setLength(u.minDistance));n.copy(A)}}};this.update=function(){a.subVectors(u.object.position,u.target);if(!u.noRotate){u.rotateCamera()}if(!u.noZoom){u.zoomCamera()}if(!u.noPan){u.panCamera()}u.object.position.addVectors(u.target,a);u.checkDistances();u.object.lookAt(u.target);if(l.distanceToSquared(u.object.position)>m){u.dispatchEvent(E);l.copy(u.object.position)}};this.reset=function(){x=w.NONE;p=w.NONE;u.target.copy(u.target0);u.object.position.copy(u.position0);u.object.up.copy(u.up0);a.subVectors(u.object.position,u.target);u.object.lookAt(u.target);u.dispatchEvent(E);l.copy(u.object.position)};function i(I){if(u.enabled===false){return}window.removeEventListener("keydown",i);p=x;if(x!==w.NONE){return}else{if(I.keyCode===u.keys[w.ROTATE]&&!u.noRotate){x=w.ROTATE}else{if(I.keyCode===u.keys[w.ZOOM]&&!u.noZoom){x=w.ZOOM}else{if(I.keyCode===u.keys[w.PAN]&&!u.noPan){x=w.PAN}}}}}function g(I){if(u.enabled===false){return}x=p;window.addEventListener("keydown",i,false)}function s(I){if(u.enabled===false){return}I.preventDefault();I.stopPropagation();if(x===w.NONE){x=I.button}if(x===w.ROTATE&&!u.noRotate){C.copy(e(I.pageX,I.pageY));q.copy(C)}else{if(x===w.ZOOM&&!u.noZoom){n.copy(c(I.pageX,I.pageY));A.copy(n)}else{if(x===w.PAN&&!u.noPan){f.copy(c(I.pageX,I.pageY));z.copy(f)}}}document.addEventListener("mousemove",B,false);document.addEventListener("mouseup",t,false);u.dispatchEvent(o)}function B(I){if(u.enabled===false){return}I.preventDefault();I.stopPropagation();if(x===w.ROTATE&&!u.noRotate){q.copy(C);C.copy(e(I.pageX,I.pageY))}else{if(x===w.ZOOM&&!u.noZoom){A.copy(c(I.pageX,I.pageY))}else{if(x===w.PAN&&!u.noPan){z.copy(c(I.pageX,I.pageY))}}}}function t(I){if(u.enabled===false){return}I.preventDefault();I.stopPropagation();x=w.NONE;document.removeEventListener("mousemove",B);document.removeEventListener("mouseup",t);u.dispatchEvent(j)}function r(I){if(u.enabled===false){return}if(u.noZoom===true){return}I.preventDefault();I.stopPropagation();switch(I.deltaMode){case 2:n.y-=I.deltaY*0.025;break;case 1:n.y-=I.deltaY*0.01;break;default:n.y-=I.deltaY*0.00025;break}u.dispatchEvent(o);u.dispatchEvent(j)}function y(L){if(u.enabled===false){return}L.preventDefault();switch(L.touches.length){case 1:x=w.TOUCH_ROTATE;C.copy(e(L.touches[0].pageX,L.touches[0].pageY));q.copy(C);break;default:x=w.TOUCH_ZOOM_PAN;var K=L.touches[0].pageX-L.touches[1].pageX;var J=L.touches[0].pageY-L.touches[1].pageY;d=k=Math.sqrt(K*K+J*J);var I=(L.touches[0].pageX+L.touches[1].pageX)/2;var M=(L.touches[0].pageY+L.touches[1].pageY)/2;f.copy(c(I,M));z.copy(f);break}u.dispatchEvent(o)}function h(L){if(u.enabled===false){return}L.preventDefault();L.stopPropagation();switch(L.touches.length){case 1:q.copy(C);C.copy(e(L.touches[0].pageX,L.touches[0].pageY));break;default:var K=L.touches[0].pageX-L.touches[1].pageX;var J=L.touches[0].pageY-L.touches[1].pageY;d=Math.sqrt(K*K+J*J);var I=(L.touches[0].pageX+L.touches[1].pageX)/2;var M=(L.touches[0].pageY+L.touches[1].pageY)/2;z.copy(c(I,M));break}}function D(I){if(u.enabled===false){return}switch(I.touches.length){case 0:x=w.NONE;break;case 1:x=w.TOUCH_ROTATE;C.copy(e(I.touches[0].pageX,I.touches[0].pageY));q.copy(C);break}u.dispatchEvent(j)}function v(I){if(u.enabled===false){return}I.preventDefault()}this.dispose=function(){this.domElement.removeEventListener("contextmenu",v,false);this.domElement.removeEventListener("mousedown",s,false);this.domElement.removeEventListener("wheel",r,false);this.domElement.removeEventListener("touchstart",y,false);this.domElement.removeEventListener("touchend",D,false);this.domElement.removeEventListener("touchmove",h,false);document.removeEventListener("mousemove",B,false);document.removeEventListener("mouseup",t,false);window.removeEventListener("keydown",i,false);window.removeEventListener("keyup",g,false)};this.domElement.addEventListener("contextmenu",v,false);this.domElement.addEventListener("mousedown",s,false);this.domElement.addEventListener("wheel",r,false);this.domElement.addEventListener("touchstart",y,false);this.domElement.addEventListener("touchend",D,false);this.domElement.addEventListener("touchmove",h,false);window.addEventListener("keydown",i,false);window.addEventListener("keyup",g,false);this.handleResize();this.update()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;
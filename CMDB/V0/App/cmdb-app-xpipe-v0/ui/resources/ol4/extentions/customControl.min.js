function searchControl(b){var a=b||{};this.element=document.createElement("div");this.element.className="ol-search-collapsed ol-control";this.search_icon=document.createElement("button");this.search_icon.className="ol-search-icon";this.input=document.createElement("INPUT");this.input.className="ol-input-text";this.input.type="TEXT";this.search_action=document.createElement("button");this.search_action.className="ol-search-action";this.delete_action=document.createElement("button");this.delete_action.className="ol-delete-action";this.element.appendChild(this.search_icon);this.element.appendChild(this.input);this.element.appendChild(this.search_action);this.element.appendChild(this.delete_action);ol.events.listen(this.search_icon,ol.events.EventType.CLICK,searchControl.prototype.handleClick_.bind(this));ol.events.listen(this.search_action,ol.events.EventType.CLICK,searchControl.prototype.handleSearch_.bind(this));ol.events.listen(this.delete_action,ol.events.EventType.CLICK,searchControl.prototype.handleDelete_.bind(this));ol.events.listen(this.input,ol.events.EventType.KEYDOWN,searchControl.prototype.handleKeyDown_.bind(this));this._expanded=false;ol.control.Control.call(this,{element:this.element,target:a.target})}ol.inherits(searchControl,ol.control.Control);searchControl.prototype.baseUrl="https://nominatim.openstreetmap.org";searchControl.prototype.handleClick_=function(a){a.preventDefault();if(this._isExpanded()){this.collapse();this.removeSearchResults()}else{this.expand()}};searchControl.prototype._isExpanded=function(){return this.element.className.includes("expanded")};searchControl.prototype.expand=function(){this.element.classList.remove("ol-search-collapsed");this.element.classList.add("ol-search-expanded")};searchControl.prototype.collapse=function(){this.element.classList.remove("ol-search-expanded");this.element.classList.add("ol-search-collapsed")};searchControl.prototype.handleSearch_=function(){if(Ext.isEmpty(this.input.value.trim())){return}var a=this;Ext.Ajax.request({url:Ext.String.format("{0}/search/?format=json&q={1}",this.baseUrl,this.input.value),method:"GET",withCredentials:false,success:function(b){var c=JSON.parse(b.responseText);a.showSearchResults(c)},failure:function(){a.showSearchResults({message:CMDBuildUI.locales.Locales.gis.extension.errorCall})}})};searchControl.prototype.handleKeyDown_=function(a){if(a.key=="Enter"){this.handleSearch_()}};searchControl.prototype.handleDelete_=function(){this.removeSearchResults();this.input.value=""};searchControl.prototype.showSearchResults=function(a){this.removeSearchResults();if(a.length!=0){this._createSearchResults(a)}else{this._createSearchResults({message:CMDBuildUI.locales.Locales.gis.extension.noResults})}this.element.appendChild(this.list)};searchControl.prototype.removeSearchResults=function(){if(this.list){this.list.remove()}};searchControl.prototype._createSearchResults=function(b){this.list=document.createElement("div");this.list.className="ol-span-container";if(Ext.isArray(b)){b.forEach(function(d){var c=document.createElement("span");c.className="ol-span";c.innerHTML=d.display_name;this.list.appendChild(c);ol.events.listen(c,ol.events.EventType.CLICK,searchControl.prototype.spanclickhandler_.bind(this,d))},this)}else{var a=document.createElement("span");a.className="ol-span";a.innerHTML=b.message;this.list.appendChild(a)}};searchControl.prototype.spanclickhandler_=function(b,a){var c=ol.proj.transform([Number(b.lon),Number(b.lat)],"EPSG:4326","EPSG:3857");this.getMap().getView().setCenter(c);this.getMap().getView().setZoom(18)};
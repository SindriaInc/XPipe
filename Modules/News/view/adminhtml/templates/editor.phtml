<script type="text/javascript" src="<?= $block->getViewFileUrl('Sindria_News::js/tinymce/tinymce.min.js') ?>"></script>

<script type="text/javascript">
    require(['jquery', 'domReady!'], function($) {

        function initTiny() {
            if (typeof tinymce !== 'undefined' && $('textarea[name="content"]').length > 0) {
                tinymce.remove('textarea[name="content"]'); // Pulisce eventuali TinyMCE precedenti
                tinymce.init({
                    selector: 'textarea[name="content"]',
                    menubar: false,
                    height: 300,
                    promotion: false, // Disabilita le chiamate a sp.tinymce.com
                    branding: false,
                    license_key: 'gpl', // Elimina l'avviso della licenza in console
                    plugins: 'lists link image media table code help wordcount',
                    toolbar: 'undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | image | removeformat | help',
                    skin_url: '<?= $block->getViewFileUrl('Sindria_News::js/tinymce/skins/ui/oxide') ?>',
                    content_css: '<?= $block->getViewFileUrl('Sindria_News::js/tinymce/skins/content/default/content.min.css') ?>'
                });
                console.log('âœ… TinyMCE initialized');
            } else {
                console.warn('âŒ› Waiting for textarea or TinyMCE...');
                setTimeout(initTiny, 200); // Retry ogni 200ms
            }
        }

        $(document).on('contentUpdated', function() {
            console.log('ðŸ”„ Magento contentUpdated fired');
            setTimeout(initTiny, 300);
        });

        waitForTinyMCE(initTiny);

        function waitForTinyMCE(callback) {
            if (typeof tinymce !== 'undefined') {
                callback();
            } else {
                console.log('âŒ› Waiting TinyMCE to be available...');
                setTimeout(function() {
                    waitForTinyMCE(callback);
                }, 100);
            }
        }
    });
</script>
